# 聊天室使用指南

## 🎯 聊天室功能已修复！

聊天室功能现在已经可以正常使用了。以下是使用指南：

## 🚀 快速开始

### 1. 访问聊天室入口
- 登录系统后访问: `http://localhost:8000/tools/chat/`
- 或者直接访问: `http://localhost:8000/tools/chat/enhanced/test-room-123/`

### 2. 聊天室功能

#### 🔢 数字匹配
- 访问: `http://localhost:8000/tools/number-match/`
- 输入4位数字，系统会自动匹配相同数字的用户
- 匹配成功后自动进入聊天室

#### 💬 直接聊天
- 访问: `http://localhost:8000/tools/chat/`
- 选择"直接聊天"进入测试聊天室
- 或者输入聊天室ID直接进入

#### ❤️ 心动链接
- 访问: `http://localhost:8000/tools/heart_link/`
- 创建心动链接请求，等待其他用户匹配

## 🔧 技术特性

### WebSocket实时通信
- ✅ 基于Django Channels和Daphne ASGI服务器
- ✅ 实时消息发送和接收
- ✅ 用户在线状态管理
- ✅ 连接状态监控和自动重连

### 消息类型支持
- ✅ 文本消息
- ✅ 表情消息
- ✅ 图片消息
- ✅ 语音消息
- ✅ 文件消息
- ✅ 视频消息

### 用户资料展示
- ✅ 用户头像显示
- ✅ 用户昵称和真实姓名
- ✅ 用户个人简介
- ✅ 会员类型显示
- ✅ 动态用户标签系统

## 🛠️ 调试功能

### 聊天室调试页面
访问: `http://localhost:8000/tools/chat/debug/test-room-123/`

功能包括：
- WebSocket连接状态监控
- 消息发送和接收测试
- 详细的调试日志
- 连接错误诊断

## 📱 使用步骤

### 步骤1: 登录系统
确保你已经登录系统，聊天室功能需要用户认证。

### 步骤2: 选择聊天方式
- **数字匹配**: 输入4位数字进行匹配
- **直接聊天**: 直接进入聊天室
- **心动链接**: 创建匹配请求

### 步骤3: 开始聊天
- 在聊天界面输入消息
- 使用表情、图片、语音等功能
- 查看对方在线状态

### 步骤4: 视频通话（可选）
- 点击视频通话按钮
- 允许摄像头和麦克风权限
- 开始视频对话

## 🆘 常见问题

### Q: 无法连接WebSocket
**A:** 确保使用ASGI服务器（Daphne），而不是普通的Django开发服务器

### Q: 聊天室显示"未连接"
**A:** 
1. 检查网络连接
2. 确保服务器正在运行
3. 尝试刷新页面

### Q: 无法发送消息
**A:**
1. 检查WebSocket连接状态
2. 确保消息不为空
3. 查看浏览器控制台错误信息

### Q: 其他用户看不到我的消息
**A:**
1. 确保对方也在同一个聊天室
2. 检查对方的WebSocket连接状态
3. 确认聊天室权限设置

## 🔍 故障排除

### 检查服务器状态
```bash
# 检查ASGI服务器是否运行
ps aux | grep daphne

# 检查端口8000是否被占用
lsof -i :8000
```

### 检查WebSocket连接
在浏览器控制台中运行：
```javascript
const ws = new WebSocket('ws://localhost:8000/ws/chat/test-room-123/');
ws.onopen = () => console.log('Connected');
ws.onmessage = (event) => console.log('Message:', event.data);
ws.onerror = (error) => console.error('Error:', error);
```

### 查看服务器日志
服务器日志会显示WebSocket连接和错误信息。

## 📞 技术支持

如果遇到问题，请：

1. 查看浏览器控制台错误信息
2. 检查服务器日志
3. 使用调试页面进行诊断
4. 确认所有依赖都已正确安装

## 🎉 享受聊天！

现在你可以享受完整的聊天室功能了！
