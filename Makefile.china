# QAToolBox 中国部署 Makefile

.PHONY: help install deploy start stop restart logs status backup monitor update clean

help: ## 显示帮助信息
	@echo "QAToolBox 部署管理命令:"
	@echo ""
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2}'

install: ## 一键安装部署
	@echo "🚀 开始一键安装..."
	@chmod +x deploy_china.sh
	@./deploy_china.sh

deploy: ## 部署应用
	@echo "🚀 部署应用..."
	@docker-compose -f docker-compose.china.yml up -d --build

start: ## 启动服务
	@echo "▶️ 启动服务..."
	@docker-compose -f docker-compose.china.yml up -d

stop: ## 停止服务
	@echo "⏹️ 停止服务..."
	@docker-compose -f docker-compose.china.yml down

restart: ## 重启服务
	@echo "🔄 重启服务..."
	@docker-compose -f docker-compose.china.yml restart

logs: ## 查看日志
	@echo "📝 查看实时日志..."
	@docker-compose -f docker-compose.china.yml logs -f

status: ## 检查服务状态
	@echo "📊 检查服务状态..."
	@chmod +x monitor.sh
	@./monitor.sh

backup: ## 备份数据
	@echo "🗄️ 备份数据..."
	@chmod +x backup.sh
	@./backup.sh

update: ## 更新代码并重新部署
	@echo "🔄 更新代码..."
	@git pull origin main
	@docker-compose -f docker-compose.china.yml up -d --build

clean: ## 清理Docker缓存
	@echo "🧹 清理Docker缓存..."
	@docker system prune -f
	@docker volume prune -f

monitor: ## 持续监控服务
	@echo "👁️ 持续监控服务 (Ctrl+C退出)..."
	@while true; do \
		clear; \
		make status; \
		sleep 30; \
	done

