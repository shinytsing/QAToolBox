<!--pages/fitness/fitness.wxml-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="page-title">å¥èº«ç®¡ç†</view>
    <view class="page-subtitle">è®°å½•æ¯ä¸€æ¬¡è®­ç»ƒï¼Œè§è¯æ¯ä¸€æ¬¡æˆé•¿</view>
  </view>

  <!-- ç”¨æˆ·èµ„æ–™ -->
  <view class="card" wx:if="{{userProfile}}">
    <view class="user-profile">
      <view class="profile-avatar">
        <image src="{{userProfile.avatar || '/images/default-avatar.png'}}" mode="aspectFill"></image>
      </view>
      <view class="profile-info">
        <view class="profile-name">{{userProfile.username}}</view>
        <view class="profile-level">Lv.{{userProfile.level || 1}}</view>
        <view class="profile-exp">
          <view class="exp-bar">
            <view class="exp-progress" style="width: {{userProfile.exp_percentage || 0}}%"></view>
          </view>
          <view class="exp-text">{{userProfile.current_exp || 0}}/{{userProfile.next_level_exp || 1000}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ•°æ®ç»Ÿè®¡ -->
  <view class="stats-card">
    <view class="stats-header">
      <view class="stats-title">æ•°æ®ç»Ÿè®¡</view>
      <view class="stats-refresh" bindtap="onViewDetail" data-type="stats">
        <text class="refresh-icon">ğŸ“Š</text>
      </view>
    </view>
    <view class="stats-content">
      <view class="stat-item">
        <view class="stat-number">{{stats.totalWorkouts}}</view>
        <view class="stat-label">æ€»è®­ç»ƒæ¬¡æ•°</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{stats.totalMinutes}}</view>
        <view class="stat-label">æ€»è®­ç»ƒæ—¶é•¿(åˆ†é’Ÿ)</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{stats.totalCalories}}</view>
        <view class="stat-label">æ€»æ¶ˆè€—å¡è·¯é‡Œ</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{stats.streakDays}}</view>
        <view class="stat-label">è¿ç»­è®­ç»ƒå¤©æ•°</view>
      </view>
    </view>
  </view>

  <!-- æœ¬å‘¨ç›®æ ‡ -->
  <view class="card">
    <view class="card-header">
      <view class="card-title">æœ¬å‘¨ç›®æ ‡</view>
      <view class="card-action" bindtap="onSetGoals">
        <text>è®¾ç½®</text>
      </view>
    </view>
    <view class="goals-content">
      <view class="goal-item">
        <view class="goal-label">è®­ç»ƒæ¬¡æ•°</view>
        <view class="goal-progress">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{(currentWeek.workouts / goals.weeklyWorkouts) * 100}}%"></view>
          </view>
          <view class="progress-text">{{currentWeek.workouts}}/{{goals.weeklyWorkouts}}</view>
        </view>
      </view>
      <view class="goal-item">
        <view class="goal-label">è®­ç»ƒæ—¶é•¿</view>
        <view class="goal-progress">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{(currentWeek.minutes / goals.weeklyMinutes) * 100}}%"></view>
          </view>
          <view class="progress-text">{{currentWeek.minutes}}/{{goals.weeklyMinutes}}åˆ†é’Ÿ</view>
        </view>
      </view>
      <view class="goal-item">
        <view class="goal-label">æ¶ˆè€—å¡è·¯é‡Œ</view>
        <view class="goal-progress">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{(currentWeek.calories / goals.weeklyCalories) * 100}}%"></view>
          </view>
          <view class="progress-text">{{currentWeek.calories}}/{{goals.weeklyCalories}}å¡</view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œ -->
  <view class="card">
    <view class="card-header">
      <view class="card-title">å¿«é€Ÿæ“ä½œ</view>
    </view>
    <view class="quick-actions">
      <view class="action-item" bindtap="onStartWorkout">
        <view class="action-icon">ğŸƒâ€â™‚ï¸</view>
        <view class="action-text">å¼€å§‹è®­ç»ƒ</view>
      </view>
      <view class="action-item" bindtap="onViewWorkouts">
        <view class="action-icon">ğŸ“</view>
        <view class="action-text">è®­ç»ƒè®°å½•</view>
      </view>
      <view class="action-item" bindtap="onViewAchievements">
        <view class="action-icon">ğŸ†</view>
        <view class="action-text">æˆå°±ç³»ç»Ÿ</view>
      </view>
      <view class="action-item" bindtap="onSetGoals">
        <view class="action-icon">ğŸ¯</view>
        <view class="action-text">ç›®æ ‡è®¾ç½®</view>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘è®­ç»ƒ -->
  <view class="card" wx:if="{{recentWorkouts.length > 0}}">
    <view class="card-header">
      <view class="card-title">æœ€è¿‘è®­ç»ƒ</view>
      <view class="card-more" bindtap="onViewWorkouts">
        <text>æ›´å¤š</text>
        <text class="list-item-arrow">></text>
      </view>
    </view>
    <view class="list">
      <view 
        class="list-item" 
        wx:for="{{recentWorkouts}}" 
        wx:key="id"
      >
        <view class="workout-icon">
          <text>{{item.type_icon || 'ğŸ’ª'}}</text>
        </view>
        <view class="list-item-content">
          <view class="list-item-title">{{item.name}}</view>
          <view class="list-item-desc">{{item.duration}}åˆ†é’Ÿ Â· {{item.calories}}å¡è·¯é‡Œ</view>
          <view class="list-item-time">{{item.created_at}}</view>
        </view>
        <view class="workout-status {{item.status}}">
          {{item.status === 'completed' ? 'å®Œæˆ' : 'è¿›è¡Œä¸­'}}
        </view>
      </view>
    </view>
  </view>

  <!-- æˆå°±å±•ç¤º -->
  <view class="card" wx:if="{{achievements.length > 0}}">
    <view class="card-header">
      <view class="card-title">æœ€æ–°æˆå°±</view>
      <view class="card-more" bindtap="onViewAchievements">
        <text>æ›´å¤š</text>
        <text class="list-item-arrow">></text>
      </view>
    </view>
    <view class="achievements-grid">
      <view 
        class="achievement-item {{item.earned ? 'earned' : ''}}" 
        wx:for="{{achievements}}" 
        wx:key="id"
      >
        <view class="achievement-icon">
          <text>{{item.icon}}</text>
        </view>
        <view class="achievement-name">{{item.name}}</view>
        <view class="achievement-desc">{{item.description}}</view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{recentWorkouts.length === 0}}">
    <view class="empty-icon">ğŸ’ª</view>
    <view class="empty-text">è¿˜æ²¡æœ‰è®­ç»ƒè®°å½•</view>
    <view class="empty-desc">å¼€å§‹ä½ çš„ç¬¬ä¸€æ¬¡è®­ç»ƒå§ï¼</view>
    <button class="btn btn-primary" bindtap="onStartWorkout">å¼€å§‹è®­ç»ƒ</button>
  </view>
</view>
