{% extends 'base.html' %}
{% load static %}

{% block title %}APIåŠŸèƒ½æµ‹è¯•{% endblock %}

{% block extra_css %}
<style>
.test-container {
  min-height: 100vh;
  background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
  color: #ffffff;
  padding: 2rem;
}

.test-header {
  text-align: center;
  margin-bottom: 3rem;
}

.test-title {
  font-size: 3rem;
  font-weight: 900;
  background: linear-gradient(135deg, #ff4444, #ff6b35, #ffd700);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 1rem;
}

.test-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 2rem;
  max-width: 1600px;
  margin: 0 auto;
}

.test-card {
  background: rgba(26, 26, 26, 0.9);
  border: 3px solid rgba(255, 68, 68, 0.4);
  border-radius: 15px;
  padding: 2rem;
  text-align: center;
}

.test-card h3 {
  color: #ff4444;
  margin-bottom: 1rem;
}

.test-btn {
  background: linear-gradient(45deg, #ff4444, #ff6b35);
  color: white;
  border: none;
  padding: 1rem 2rem;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  margin: 0.5rem;
  text-decoration: none;
  display: inline-block;
}

.test-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(255, 68, 68, 0.4);
}

.api-result {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 68, 68, 0.3);
  border-radius: 8px;
  padding: 1rem;
  margin-top: 1rem;
  text-align: left;
  font-family: monospace;
  white-space: pre-wrap;
  max-height: 200px;
  overflow-y: auto;
}

.success {
  border-color: #28a745;
  color: #28a745;
}

.error {
  border-color: #dc3545;
  color: #dc3545;
}
</style>
{% endblock %}

{% block content %}
<div class="test-container">
  <div class="test-header">
    <h1 class="test-title">ğŸ”§ APIåŠŸèƒ½æµ‹è¯•</h1>
    <p>æµ‹è¯•æ–°å¢çš„APIæ¥å£åŠŸèƒ½</p>
  </div>

  <div class="test-grid">
    <!-- åç¨‹åºå‘˜å½¢è±¡APIæµ‹è¯• -->
    <div class="test-card">
      <h3>ğŸ¤– åç¨‹åºå‘˜å½¢è±¡API</h3>
      <p>æµ‹è¯•åç¨‹åºå‘˜å½¢è±¡ç›¸å…³çš„APIæ¥å£</p>
      
      <button class="test-btn" onclick="testBasedDevAPI()">æµ‹è¯•è·å–å½¢è±¡API</button>
      <button class="test-btn" onclick="testAchievementsAPI()">æµ‹è¯•æˆå°±API</button>
      
      <div id="basedDevResult" class="api-result" style="display: none;"></div>
    </div>

    <!-- æ¬²æœ›ä»£åŠAPIæµ‹è¯• -->
    <div class="test-card">
      <h3>ğŸ’ æ¬²æœ›ä»£åŠAPI</h3>
      <p>æµ‹è¯•æ¬²æœ›ä»£åŠç›¸å…³çš„APIæ¥å£</p>
      
      <button class="test-btn" onclick="testDesireTodosAPI()">æµ‹è¯•è·å–ä»£åŠAPI</button>
      <button class="test-btn" onclick="testDesireStatsAPI()">æµ‹è¯•ç»Ÿè®¡API</button>
      
      <div id="desireResult" class="api-result" style="display: none;"></div>
    </div>

    <!-- åŠŸèƒ½æ€»ç»“ -->
    <div class="test-card">
      <h3>ğŸ“Š åŠŸèƒ½æ€»ç»“</h3>
      <p>æ–°å¢åŠŸèƒ½çš„æ€»ç»“</p>
      
      <div style="text-align: left; margin-top: 1rem;">
        <h4>ğŸ¤– åç¨‹åºå‘˜å½¢è±¡ç³»ç»Ÿ</h4>
        <ul>
          <li>âœ“ ç­‰çº§ç³»ç»Ÿ (LV.1-10)</li>
          <li>âœ“ ç»éªŒå€¼è¿›åº¦æ¡</li>
          <li>âœ“ æˆå°±ç³»ç»Ÿ</li>
          <li>âœ“ å®æ—¶ç»Ÿè®¡</li>
          <li>âœ“ 4ä¸ªAPIæ¥å£</li>
        </ul>
        
        <h4>ğŸ’ æ¬²æœ›ä»£åŠç³»ç»Ÿ</h4>
        <ul>
          <li>âœ“ åˆ†ç±»ç®¡ç†</li>
          <li>âœ“ ä¼˜å…ˆçº§ç³»ç»Ÿ</li>
          <li>âœ“ å¥–åŠ±ç³»ç»Ÿ</li>
          <li>âœ“ å®æ—¶ç»Ÿè®¡</li>
          <li>âœ“ 6ä¸ªAPIæ¥å£</li>
        </ul>
      </div>
    </div>

    <!-- è®¿é—®é“¾æ¥ -->
    <div class="test-card">
      <h3>ğŸ”— è®¿é—®é“¾æ¥</h3>
      <p>ç›´æ¥è®¿é—®åŠŸèƒ½é¡µé¢</p>
      
      <a href="/tools/based-dev-avatar/" class="test-btn">åç¨‹åºå‘˜å½¢è±¡</a>
      <a href="/tools/desire-todo-enhanced/" class="test-btn">æ¬²æœ›ä»£åŠç³»ç»Ÿ</a>
      <a href="/tools/test-desire-todo-public/" class="test-btn">æµ‹è¯•é¡µé¢</a>
    </div>
  </div>
</div>

<script>
async function testBasedDevAPI() {
  const resultDiv = document.getElementById('basedDevResult');
  resultDiv.style.display = 'block';
  resultDiv.className = 'api-result';
  resultDiv.textContent = 'æµ‹è¯•ä¸­...';
  
  try {
    const response = await fetch('/tools/api/based-dev-avatar/get/');
    const data = await response.json();
    
    if (data.success) {
      resultDiv.className = 'api-result success';
      resultDiv.textContent = `âœ… åç¨‹åºå‘˜å½¢è±¡APIæµ‹è¯•æˆåŠŸï¼
      
ç­‰çº§: ${data.user_stats.level}
ç§°å·: ${data.user_stats.title}
ä»£ç è¡Œæ•°: ${data.user_stats.total_code_lines}
å½¢è±¡æ•°é‡: ${data.user_stats.total_avatars}
æˆå°±æ•°é‡: ${data.achievements.length}`;
    } else {
      resultDiv.className = 'api-result error';
      resultDiv.textContent = `âŒ APIæµ‹è¯•å¤±è´¥: ${data.error}`;
    }
  } catch (error) {
    resultDiv.className = 'api-result error';
    resultDiv.textContent = `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`;
  }
}

async function testAchievementsAPI() {
  const resultDiv = document.getElementById('basedDevResult');
  resultDiv.style.display = 'block';
  resultDiv.className = 'api-result';
  resultDiv.textContent = 'æµ‹è¯•ä¸­...';
  
  try {
    const response = await fetch('/tools/api/based-dev-avatar/achievements/');
    const data = await response.json();
    
    if (data.success) {
      resultDiv.className = 'api-result success';
      resultDiv.textContent = `âœ… æˆå°±APIæµ‹è¯•æˆåŠŸï¼
      
æˆå°±æ•°é‡: ${data.achievements.length}
ä»£ç è¡Œæ•°: ${data.stats.total_code_lines}
ç‚¹èµæ•°: ${data.stats.total_likes}
å½¢è±¡æ•°: ${data.stats.total_avatars}`;
    } else {
      resultDiv.className = 'api-result error';
      resultDiv.textContent = `âŒ APIæµ‹è¯•å¤±è´¥: ${data.error}`;
    }
  } catch (error) {
    resultDiv.className = 'api-result error';
    resultDiv.textContent = `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`;
  }
}

async function testDesireTodosAPI() {
  const resultDiv = document.getElementById('desireResult');
  resultDiv.style.display = 'block';
  resultDiv.className = 'api-result';
  resultDiv.textContent = 'æµ‹è¯•ä¸­...';
  
  try {
    const response = await fetch('/tools/api/desire-todos/');
    const data = await response.json();
    
    if (data.success) {
      resultDiv.className = 'api-result success';
      resultDiv.textContent = `âœ… æ¬²æœ›ä»£åŠAPIæµ‹è¯•æˆåŠŸï¼
      
ä»£åŠæ•°é‡: ${data.todos.length}
ç¤ºä¾‹ä»£åŠ: ${data.todos[0]?.title || 'æ— '}`;
    } else {
      resultDiv.className = 'api-result error';
      resultDiv.textContent = `âŒ APIæµ‹è¯•å¤±è´¥: ${data.error}`;
    }
  } catch (error) {
    resultDiv.className = 'api-result error';
    resultDiv.textContent = `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`;
  }
}

async function testDesireStatsAPI() {
  const resultDiv = document.getElementById('desireResult');
  resultDiv.style.display = 'block';
  resultDiv.className = 'api-result';
  resultDiv.textContent = 'æµ‹è¯•ä¸­...';
  
  try {
    const response = await fetch('/tools/api/desire-todos/stats/');
    const data = await response.json();
    
    if (data.success) {
      resultDiv.className = 'api-result success';
      resultDiv.textContent = `âœ… ç»Ÿè®¡APIæµ‹è¯•æˆåŠŸï¼
      
æ€»ä»£åŠ: ${data.stats.total_todos}
å·²å®Œæˆ: ${data.stats.completed_todos}
å¾…å®Œæˆ: ${data.stats.pending_todos}
æ€»å¥–åŠ±: ${data.stats.total_rewards}
å®Œæˆç‡: ${data.stats.completion_rate}%`;
    } else {
      resultDiv.className = 'api-result error';
      resultDiv.textContent = `âŒ APIæµ‹è¯•å¤±è´¥: ${data.error}`;
    }
  } catch (error) {
    resultDiv.className = 'api-result error';
    resultDiv.textContent = `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`;
  }
}

// é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
  console.log('APIæµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
  console.log('æ–°å¢åŠŸèƒ½ï¼š');
  console.log('- åç¨‹åºå‘˜å½¢è±¡ç­‰çº§ç³»ç»Ÿ');
  console.log('- æ¬²æœ›ä»£åŠåˆ†ç±»ç®¡ç†');
  console.log('- å®æ—¶APIæ¥å£');
  console.log('- æˆå°±å’Œå¥–åŠ±ç³»ç»Ÿ');
});
</script>
{% endblock %} 