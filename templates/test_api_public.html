{% extends 'base.html' %}
{% load static %}

{% block title %}API功能测试{% endblock %}

{% block extra_css %}
<style>
.test-container {
  min-height: 100vh;
  background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
  color: #ffffff;
  padding: 2rem;
}

.test-header {
  text-align: center;
  margin-bottom: 3rem;
}

.test-title {
  font-size: 3rem;
  font-weight: 900;
  background: linear-gradient(135deg, #ff4444, #ff6b35, #ffd700);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 1rem;
}

.test-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 2rem;
  max-width: 1600px;
  margin: 0 auto;
}

.test-card {
  background: rgba(26, 26, 26, 0.9);
  border: 3px solid rgba(255, 68, 68, 0.4);
  border-radius: 15px;
  padding: 2rem;
  text-align: center;
}

.test-card h3 {
  color: #ff4444;
  margin-bottom: 1rem;
}

.test-btn {
  background: linear-gradient(45deg, #ff4444, #ff6b35);
  color: white;
  border: none;
  padding: 1rem 2rem;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  margin: 0.5rem;
  text-decoration: none;
  display: inline-block;
}

.test-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(255, 68, 68, 0.4);
}

.api-result {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 68, 68, 0.3);
  border-radius: 8px;
  padding: 1rem;
  margin-top: 1rem;
  text-align: left;
  font-family: monospace;
  white-space: pre-wrap;
  max-height: 200px;
  overflow-y: auto;
}

.success {
  border-color: #28a745;
  color: #28a745;
}

.error {
  border-color: #dc3545;
  color: #dc3545;
}
</style>
{% endblock %}

{% block content %}
<div class="test-container">
  <div class="test-header">
    <h1 class="test-title">🔧 API功能测试</h1>
    <p>测试新增的API接口功能</p>
  </div>

  <div class="test-grid">
    <!-- 反程序员形象API测试 -->
    <div class="test-card">
      <h3>🤖 反程序员形象API</h3>
      <p>测试反程序员形象相关的API接口</p>
      
      <button class="test-btn" onclick="testBasedDevAPI()">测试获取形象API</button>
      <button class="test-btn" onclick="testAchievementsAPI()">测试成就API</button>
      
      <div id="basedDevResult" class="api-result" style="display: none;"></div>
    </div>

    <!-- 欲望代办API测试 -->
    <div class="test-card">
      <h3>💎 欲望代办API</h3>
      <p>测试欲望代办相关的API接口</p>
      
      <button class="test-btn" onclick="testDesireTodosAPI()">测试获取代办API</button>
      <button class="test-btn" onclick="testDesireStatsAPI()">测试统计API</button>
      
      <div id="desireResult" class="api-result" style="display: none;"></div>
    </div>

    <!-- 功能总结 -->
    <div class="test-card">
      <h3>📊 功能总结</h3>
      <p>新增功能的总结</p>
      
      <div style="text-align: left; margin-top: 1rem;">
        <h4>🤖 反程序员形象系统</h4>
        <ul>
          <li>✓ 等级系统 (LV.1-10)</li>
          <li>✓ 经验值进度条</li>
          <li>✓ 成就系统</li>
          <li>✓ 实时统计</li>
          <li>✓ 4个API接口</li>
        </ul>
        
        <h4>💎 欲望代办系统</h4>
        <ul>
          <li>✓ 分类管理</li>
          <li>✓ 优先级系统</li>
          <li>✓ 奖励系统</li>
          <li>✓ 实时统计</li>
          <li>✓ 6个API接口</li>
        </ul>
      </div>
    </div>

    <!-- 访问链接 -->
    <div class="test-card">
      <h3>🔗 访问链接</h3>
      <p>直接访问功能页面</p>
      
      <a href="/tools/based-dev-avatar/" class="test-btn">反程序员形象</a>
      <a href="/tools/desire-todo-enhanced/" class="test-btn">欲望代办系统</a>
      <a href="/tools/test-desire-todo-public/" class="test-btn">测试页面</a>
    </div>
  </div>
</div>

<script>
async function testBasedDevAPI() {
  const resultDiv = document.getElementById('basedDevResult');
  resultDiv.style.display = 'block';
  resultDiv.className = 'api-result';
  resultDiv.textContent = '测试中...';
  
  try {
    const response = await fetch('/tools/api/based-dev-avatar/get/');
    const data = await response.json();
    
    if (data.success) {
      resultDiv.className = 'api-result success';
      resultDiv.textContent = `✅ 反程序员形象API测试成功！
      
等级: ${data.user_stats.level}
称号: ${data.user_stats.title}
代码行数: ${data.user_stats.total_code_lines}
形象数量: ${data.user_stats.total_avatars}
成就数量: ${data.achievements.length}`;
    } else {
      resultDiv.className = 'api-result error';
      resultDiv.textContent = `❌ API测试失败: ${data.error}`;
    }
  } catch (error) {
    resultDiv.className = 'api-result error';
    resultDiv.textContent = `❌ 网络错误: ${error.message}`;
  }
}

async function testAchievementsAPI() {
  const resultDiv = document.getElementById('basedDevResult');
  resultDiv.style.display = 'block';
  resultDiv.className = 'api-result';
  resultDiv.textContent = '测试中...';
  
  try {
    const response = await fetch('/tools/api/based-dev-avatar/achievements/');
    const data = await response.json();
    
    if (data.success) {
      resultDiv.className = 'api-result success';
      resultDiv.textContent = `✅ 成就API测试成功！
      
成就数量: ${data.achievements.length}
代码行数: ${data.stats.total_code_lines}
点赞数: ${data.stats.total_likes}
形象数: ${data.stats.total_avatars}`;
    } else {
      resultDiv.className = 'api-result error';
      resultDiv.textContent = `❌ API测试失败: ${data.error}`;
    }
  } catch (error) {
    resultDiv.className = 'api-result error';
    resultDiv.textContent = `❌ 网络错误: ${error.message}`;
  }
}

async function testDesireTodosAPI() {
  const resultDiv = document.getElementById('desireResult');
  resultDiv.style.display = 'block';
  resultDiv.className = 'api-result';
  resultDiv.textContent = '测试中...';
  
  try {
    const response = await fetch('/tools/api/desire-todos/');
    const data = await response.json();
    
    if (data.success) {
      resultDiv.className = 'api-result success';
      resultDiv.textContent = `✅ 欲望代办API测试成功！
      
代办数量: ${data.todos.length}
示例代办: ${data.todos[0]?.title || '无'}`;
    } else {
      resultDiv.className = 'api-result error';
      resultDiv.textContent = `❌ API测试失败: ${data.error}`;
    }
  } catch (error) {
    resultDiv.className = 'api-result error';
    resultDiv.textContent = `❌ 网络错误: ${error.message}`;
  }
}

async function testDesireStatsAPI() {
  const resultDiv = document.getElementById('desireResult');
  resultDiv.style.display = 'block';
  resultDiv.className = 'api-result';
  resultDiv.textContent = '测试中...';
  
  try {
    const response = await fetch('/tools/api/desire-todos/stats/');
    const data = await response.json();
    
    if (data.success) {
      resultDiv.className = 'api-result success';
      resultDiv.textContent = `✅ 统计API测试成功！
      
总代办: ${data.stats.total_todos}
已完成: ${data.stats.completed_todos}
待完成: ${data.stats.pending_todos}
总奖励: ${data.stats.total_rewards}
完成率: ${data.stats.completion_rate}%`;
    } else {
      resultDiv.className = 'api-result error';
      resultDiv.textContent = `❌ API测试失败: ${data.error}`;
    }
  } catch (error) {
    resultDiv.className = 'api-result error';
    resultDiv.textContent = `❌ 网络错误: ${error.message}`;
  }
}

// 页面加载完成后的初始化
document.addEventListener('DOMContentLoaded', function() {
  console.log('API测试页面加载完成');
  console.log('新增功能：');
  console.log('- 反程序员形象等级系统');
  console.log('- 欲望代办分类管理');
  console.log('- 实时API接口');
  console.log('- 成就和奖励系统');
});
</script>
{% endblock %} 