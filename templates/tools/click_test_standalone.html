{% extends 'base.html' %}
{% load static %}

{% block title %}点击测试 - 独立版本{% endblock %}

{% block extra_css %}
<style>
body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    margin: 0;
    padding: 20px;
    min-height: 100vh;
    cursor: pointer;
}

.container {
    max-width: 800px;
    margin: 0 auto;
    text-align: center;
    padding: 50px 20px;
}

.title {
    font-size: 2.5rem;
    margin-bottom: 30px;
}

.counter {
    font-size: 3rem;
    margin: 30px 0;
    background: rgba(255, 255, 255, 0.1);
    padding: 20px;
    border-radius: 15px;
    backdrop-filter: blur(10px);
}

.instructions {
    font-size: 1.2rem;
    margin: 20px 0;
    opacity: 0.9;
}

.test-buttons {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 1000;
}

.test-btn {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    margin-bottom: 5px;
    display: block;
    width: 120px;
    font-size: 12px;
}

.test-btn:hover {
    background: rgba(255, 255, 255, 0.3);
}

.test-btn.red {
    background: rgba(255, 0, 0, 0.2);
}

.test-btn.green {
    background: rgba(0, 255, 0, 0.2);
}

.debug {
    position: fixed;
    top: 10px;
    left: 10px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 15px;
    border-radius: 10px;
    font-family: monospace;
    font-size: 12px;
    max-width: 300px;
    max-height: 400px;
    overflow-y: auto;
    z-index: 1000;
}

.success {
    background: rgba(76, 175, 80, 0.3);
    padding: 20px;
    border-radius: 15px;
    margin: 20px 0;
    display: none;
}
</style>
{% endblock %}

{% block content %}
<div class="test-buttons">
    <button class="test-btn" onclick="testClick()">测试点击</button>
    <button class="test-btn red" onclick="simulate4Clicks()">模拟4次点击</button>
    <button class="test-btn green" onclick="clearDebug()">清除调试</button>
</div>

<div class="debug" id="debug">
    调试信息将显示在这里...
</div>

<div class="container">
    <h1 class="title">💕 点击测试 - 独立版本</h1>
    
    <div class="counter" id="counter">点击次数: 0</div>
    
    <div class="instructions">
        在页面任意位置点击4次，3秒内完成<br>
        或者使用右上角的测试按钮
    </div>
    
    <div class="success" id="success">
        🎉 成功！您触发了4次点击！
    </div>
</div>

<script>
// 全局变量
let clickCount = 0;
let clickTimer = null;

// 调试函数
function log(message) {
    const debug = document.getElementById('debug');
    const timestamp = new Date().toLocaleTimeString();
    debug.innerHTML += `<div>[${timestamp}] ${message}</div>`;
    console.log(message);
}

// 点击处理函数
function handleClick(event) {
    log(`点击事件触发，目标: ${event.target.tagName}`);
    
    // 清除之前的计时器
    if (clickTimer) {
        clearTimeout(clickTimer);
        log('清除之前的计时器');
    }
    
    // 增加点击计数
    clickCount++;
    document.getElementById('counter').textContent = `点击次数: ${clickCount}`;
    log(`点击计数增加到: ${clickCount}`);
    
    // 设置新的计时器，3秒后重置计数
    clickTimer = setTimeout(() => {
        log('计时器重置，计数清零');
        clickCount = 0;
        document.getElementById('counter').textContent = `点击次数: ${clickCount}`;
    }, 3000);
    
    // 如果点击了4次，显示成功消息
    if (clickCount === 4) {
        log('触发4次点击！');
        clickCount = 0;
        document.getElementById('counter').textContent = `点击次数: ${clickCount}`;
        document.getElementById('success').style.display = 'block';
        
        // 3秒后隐藏成功消息
        setTimeout(() => {
            document.getElementById('success').style.display = 'none';
        }, 3000);
    }
}

// 测试点击函数
function testClick() {
    log('测试点击按钮被点击');
    alert('测试点击按钮正常工作！');
}

// 模拟4次点击
function simulate4Clicks() {
    log('模拟4次点击被调用');
    alert('开始模拟4次点击...');
    
    for (let i = 0; i < 4; i++) {
        setTimeout(() => {
            handleClick({ target: { tagName: 'BUTTON' } });
        }, i * 100);
    }
}

// 清除调试信息
function clearDebug() {
    document.getElementById('debug').innerHTML = '调试信息已清除...';
}

// 页面加载完成后的初始化
document.addEventListener('DOMContentLoaded', function() {
    log('页面加载完成');
    
    // 添加点击事件监听器
    document.addEventListener('click', handleClick);
    log('点击事件监听器已添加');
    
    // 测试事件监听器是否工作
    setTimeout(() => {
        log('💡 提示：在页面任意位置点击4次可以触发功能');
    }, 1000);
});

// 确保脚本加载完成
log('脚本开始执行');
</script>
{% endblock %}
