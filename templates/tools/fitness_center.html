{% extends "base.html" %}
{% load static %}

{% block tool_title_inner %}FitMatrix - å¥èº«çŸ©é˜µ{% endblock %}
{% block tool_title_display %}FitMatrix - å¥èº«çŸ©é˜µ{% endblock %}

{% block content %}
{% csrf_token %}
<div class="fitness-container">


  <!-- å¿«æ·é”®æç¤º -->
  <button class="shortcuts-help-btn" id="showShortcutsHelp" title="å¿«æ·é”®å¸®åŠ©">
    <i class="fas fa-keyboard"></i>
  </button>

  <!-- å¿«æ·é”®å¸®åŠ©é¢æ¿ -->
  <div class="shortcuts-help-panel" id="shortcutsHelpPanel">
    <div class="help-panel-header">
      <h3><i class="fas fa-keyboard"></i> å¿«æ·é”®å¸®åŠ©</h3>
      <button class="close-help-btn" id="closeShortcutsHelp">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="help-panel-content">
      <div class="shortcuts-section">
        <h4><i class="fas fa-palette"></i> ä¸»é¢˜åˆ‡æ¢</h4>
        <div class="shortcut-item">
          <span class="shortcut-key">Ctrl + 1</span>
          <span class="shortcut-desc">ç”Ÿæ´»æ¨¡å¼</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">Ctrl + 2</span>
          <span class="shortcut-desc">æå®¢æ¨¡å¼</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">Ctrl + 3</span>
          <span class="shortcut-desc">ç‹‚æš´æ¨¡å¼</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">Ctrl + 4</span>
          <span class="shortcut-desc">Emoæ¨¡å¼</span>
        </div>
      </div>
      <div class="shortcuts-section">
        <h4><i class="fas fa-tools"></i> å·¥å…·è·³è½¬</h4>
        <div class="shortcut-item">
          <span class="shortcut-key">Alt + E</span>
          <span class="shortcut-desc">æƒ…æ„Ÿæ—¥è®°</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">Alt + L</span>
          <span class="shortcut-desc">ç”Ÿæ´»æ—¥è®°</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">Alt + F</span>
          <span class="shortcut-desc">FitMatrix</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">Alt + C</span>
          <span class="shortcut-desc">åˆ›æ„å†™ä½œ</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">Alt + P</span>
          <span class="shortcut-desc">PDFè½¬æ¢å™¨</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">Alt + R</span>
          <span class="shortcut-desc">å°çº¢ä¹¦ç”Ÿæˆå™¨</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">Alt + T</span>
          <span class="shortcut-desc">æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå™¨</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">Alt + W</span>
          <span class="shortcut-desc">ç½‘é¡µçˆ¬è™«</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">Alt + S</span>
          <span class="shortcut-desc">è‡ªæˆ‘åˆ†æ</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">Alt + B</span>
          <span class="shortcut-desc">æ•…äº‹æ¿</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">Alt + M</span>
          <span class="shortcut-desc">éŸ³ä¹ç–—æ„ˆ</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">Alt + D</span>
          <span class="shortcut-desc">å†¥æƒ³æŒ‡å—</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">Alt + A</span>
          <span class="shortcut-desc">è¿åŠ¿åˆ†æ</span>
        </div>
      </div>
    </div>
  </div>

  <!-- é®ç½©å±‚ -->
  <div class="help-overlay" id="helpOverlay"></div>

  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <div class="fitness-header">
    <div class="fitness-title">
      <i class="fas fa-dumbbell"></i>
      <span data-zh="FitMatrix" data-en="FitMatrix">FitMatrix</span>
    </div>
    <div class="fitness-subtitle" data-zh="æ™ºèƒ½å¥èº«çŸ©é˜µï¼Œé‡å¡‘èº«ä½“è¾¹ç•Œ" data-en="Intelligent Fitness Matrix, Reshape Physical Boundaries">æ™ºèƒ½å¥èº«çŸ©é˜µï¼Œé‡å¡‘èº«ä½“è¾¹ç•Œ</div>
  </div>

  <!-- ä¸»è¦åŠŸèƒ½åŒºåŸŸ -->
  <div class="fitness-main">
    <div class="fitness-grid">
      <!-- è®­ç»ƒè®¡åˆ’ -->
      <div class="fitness-card">
        <div class="fitness-card-header">
          <i class="fas fa-calendar-alt"></i>
          <h3 data-zh="è®­ç»ƒè®¡åˆ’" data-en="Training Plan">è®­ç»ƒè®¡åˆ’</h3>
          <button class="edit-plan-btn" onclick="openPlanEditor()" data-zh="ç¼–è¾‘è®¡åˆ’" data-en="Edit Plan">
            <i class="fas fa-edit"></i> ç¼–è¾‘è®¡åˆ’
          </button>
        </div>
        <div class="fitness-card-content">
          <div class="current-plan-preview">
            <div class="plan-info">
              <h4>å½“å‰è®¡åˆ’ï¼šå¢è‚Œåˆ†åŒ–è®­ç»ƒ</h4>
              <p>5å¤©åˆ†åŒ– â€¢ èƒ¸èƒŒè‚©è…¿è‡‚å¾ªç¯</p>
            </div>
            <div class="workout-plan">
              <div class="plan-day active" data-day="1">
                <span data-zh="å‘¨ä¸€" data-en="Mon">å‘¨ä¸€</span>
                <span class="plan-type" data-zh="èƒ¸éƒ¨" data-en="Chest">èƒ¸éƒ¨</span>
                <span class="plan-exercises">4ä¸ªåŠ¨ä½œ</span>
              </div>
              <div class="plan-day" data-day="2">
                <span data-zh="å‘¨äºŒ" data-en="Tue">å‘¨äºŒ</span>
                <span class="plan-type" data-zh="èƒŒéƒ¨" data-en="Back">èƒŒéƒ¨</span>
                <span class="plan-exercises">5ä¸ªåŠ¨ä½œ</span>
              </div>
              <div class="plan-day" data-day="3">
                <span data-zh="å‘¨ä¸‰" data-en="Wed">å‘¨ä¸‰</span>
                <span class="plan-type" data-zh="ä¼‘æ¯" data-en="Rest">ä¼‘æ¯</span>
                <span class="plan-exercises">æ¢å¤æ—¥</span>
              </div>
              <div class="plan-day" data-day="4">
                <span data-zh="å‘¨å››" data-en="Thu">å‘¨å››</span>
                <span class="plan-type" data-zh="è‚©éƒ¨" data-en="Shoulders">è‚©éƒ¨</span>
                <span class="plan-exercises">4ä¸ªåŠ¨ä½œ</span>
              </div>
              <div class="plan-day" data-day="5">
                <span data-zh="å‘¨äº”" data-en="Fri">å‘¨äº”</span>
                <span class="plan-type" data-zh="è…¿éƒ¨" data-en="Legs">è…¿éƒ¨</span>
                <span class="plan-exercises">5ä¸ªåŠ¨ä½œ</span>
              </div>
              <div class="plan-day" data-day="6">
                <span data-zh="å‘¨å…­" data-en="Sat">å‘¨å…­</span>
                <span class="plan-type" data-zh="æ‰‹è‡‚" data-en="Arms">æ‰‹è‡‚</span>
                <span class="plan-exercises">4ä¸ªåŠ¨ä½œ</span>
              </div>
              <div class="plan-day" data-day="7">
                <span data-zh="å‘¨æ—¥" data-en="Sun">å‘¨æ—¥</span>
                <span class="plan-type" data-zh="ä¼‘æ¯" data-en="Rest">ä¼‘æ¯</span>
                <span class="plan-exercises">æ¢å¤æ—¥</span>
              </div>
            </div>
            <div class="plan-actions">
              <button class="action-btn primary" onclick="openPlanEditor()">
                <i class="fas fa-plus"></i> åˆ›å»ºæ–°è®¡åˆ’
              </button>
              <button class="action-btn secondary" onclick="openPlanLibrary()">
                <i class="fas fa-book"></i> è®¡åˆ’åº“
              </button>
              <button class="action-btn secondary" onclick="openPlanTemplates()">
                <i class="fas fa-star"></i> æ¨¡æ¿æ¨è
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- è®­ç»ƒè®¡æ—¶å™¨ -->
      <div class="fitness-card">
        <div class="fitness-card-header">
          <i class="fas fa-stopwatch"></i>
          <h3 data-zh="è®­ç»ƒè®¡æ—¶å™¨" data-en="Workout Timer">è®­ç»ƒè®¡æ—¶å™¨</h3>
        </div>
        <div class="fitness-card-content">
          <div class="timer-display">
            <div class="timer-time" id="timerDisplay">00:00</div>
            <div class="timer-input">
              <label for="timerSeconds" data-zh="è¾“å…¥ç§’æ•°:" data-en="Enter seconds:">è¾“å…¥ç§’æ•°:</label>
              <input type="number" id="timerSeconds" placeholder="ä¾‹å¦‚: 300" min="1" max="7200">
              <button id="setTimer" data-zh="è®¾ç½®" data-en="Set">è®¾ç½®</button>
            </div>
            <div class="timer-controls">
              <button class="timer-btn" id="startTimer" data-zh="å¼€å§‹" data-en="Start">å¼€å§‹</button>
              <button class="timer-btn" id="pauseTimer" data-zh="æš‚åœ" data-en="Pause">æš‚åœ</button>
              <button class="timer-btn" id="resetTimer" data-zh="é‡ç½®" data-en="Reset">é‡ç½®</button>
            </div>
            <div class="timer-presets">
              <button class="preset-btn" data-time="300" data-zh="5åˆ†é’Ÿ" data-en="5min">5åˆ†é’Ÿ</button>
              <button class="preset-btn" data-time="600" data-zh="10åˆ†é’Ÿ" data-en="10min">10åˆ†é’Ÿ</button>
              <button class="preset-btn" data-time="1800" data-zh="30åˆ†é’Ÿ" data-en="30min">30åˆ†é’Ÿ</button>
            </div>
          </div>
        </div>
      </div>



      <!-- è¥å…»è®¡ç®—å™¨ -->
      <div class="fitness-card">
        <div class="fitness-card-header">
          <i class="fas fa-calculator"></i>
          <h3 data-zh="è¥å…»è®¡ç®—å™¨" data-en="Nutrition Calculator">è¥å…»è®¡ç®—å™¨</h3>
        </div>
        <div class="fitness-card-content">
          <div class="nutrition-calc">
            <div class="calc-input">
              <label data-zh="ä½“é‡ (kg)" data-en="Weight (kg)">ä½“é‡ (kg)</label>
              <input type="number" id="weight" placeholder="70">
            </div>
            <div class="calc-input">
              <label data-zh="èº«é«˜ (cm)" data-en="Height (cm)">èº«é«˜ (cm)</label>
              <input type="number" id="height" placeholder="175">
            </div>
            <div class="calc-input">
              <label data-zh="å¹´é¾„" data-en="Age">å¹´é¾„</label>
              <input type="number" id="age" placeholder="25">
            </div>
            <div class="calc-input">
              <label data-zh="æ´»åŠ¨æ°´å¹³" data-en="Activity Level">æ´»åŠ¨æ°´å¹³</label>
              <select id="activity">
                <option value="1.2" data-zh="ä¹…åä¸åŠ¨" data-en="Sedentary">ä¹…åä¸åŠ¨</option>
                <option value="1.375" data-zh="è½»åº¦æ´»åŠ¨" data-en="Lightly Active">è½»åº¦æ´»åŠ¨</option>
                <option value="1.55" data-zh="ä¸­åº¦æ´»åŠ¨" data-en="Moderately Active">ä¸­åº¦æ´»åŠ¨</option>
                <option value="1.725" data-zh="é«˜åº¦æ´»åŠ¨" data-en="Very Active">é«˜åº¦æ´»åŠ¨</option>
                <option value="1.9" data-zh="æé«˜æ´»åŠ¨" data-en="Extremely Active">æé«˜æ´»åŠ¨</option>
              </select>
            </div>
            <button class="calc-btn" id="calculateBMR" data-zh="è®¡ç®—åŸºç¡€ä»£è°¢ç‡" data-en="Calculate BMR">è®¡ç®—åŸºç¡€ä»£è°¢ç‡</button>
            <div class="calc-result" id="bmrResult"></div>
          </div>
        </div>
      </div>

      <!-- è¿åŠ¨è§†é¢‘ -->
      <div class="fitness-card">
        <div class="fitness-card-header">
          <i class="fas fa-play-circle"></i>
          <h3 data-zh="è¿åŠ¨è§†é¢‘" data-en="Workout Videos">è¿åŠ¨è§†é¢‘</h3>
        </div>
        <div class="fitness-card-content">
          <div class="video-grid">
            <div class="video-item">
              <div class="video-thumbnail">
                <i class="fas fa-play"></i>
              </div>
              <div class="video-title" data-zh="é«˜å¼ºåº¦é—´æ­‡è®­ç»ƒ" data-en="HIIT Workout">é«˜å¼ºåº¦é—´æ­‡è®­ç»ƒ</div>
              <div class="video-duration">15åˆ†é’Ÿ</div>
            </div>
            <div class="video-item">
              <div class="video-thumbnail">
                <i class="fas fa-play"></i>
              </div>
              <div class="video-title" data-zh="åŠ›é‡è®­ç»ƒåŸºç¡€" data-en="Strength Basics">åŠ›é‡è®­ç»ƒåŸºç¡€</div>
              <div class="video-duration">30åˆ†é’Ÿ</div>
            </div>
            <div class="video-item">
              <div class="video-thumbnail">
                <i class="fas fa-play"></i>
              </div>
              <div class="video-title" data-zh="æœ‰æ°§è¿åŠ¨" data-en="Cardio">æœ‰æ°§è¿åŠ¨</div>
              <div class="video-duration">20åˆ†é’Ÿ</div>
            </div>
          </div>
        </div>
      </div>

      <!-- æ‰“å¡æ—¥å† -->
      <div class="fitness-card checkin-calendar-card">
        <div class="fitness-card-header">
          <i class="fas fa-calendar-check"></i>
          <h3 data-zh="æ‰“å¡æ—¥å†" data-en="Check-in Calendar">æ‰“å¡æ—¥å†</h3>
        </div>
        <div class="fitness-card-content">
          <div class="checkin-calendar-container">
            <!-- æ—¥å†å¯¼èˆª -->
            <div class="calendar-nav">
              <button class="nav-btn" id="prevMonth"><i class="fas fa-chevron-left"></i></button>
              <div class="current-month" id="currentMonth">2024å¹´1æœˆ</div>
              <button class="nav-btn" id="nextMonth"><i class="fas fa-chevron-right"></i></button>
              <button class="nav-btn today-btn" id="goToday">ä»Šå¤©</button>
            </div>
            
            <!-- è¿ç»­æ‰“å¡ä¿¡æ¯ -->
            <div class="streak-info">
              <div class="streak-item">
                <i class="fas fa-fire"></i>
                <span>è¿ç»­ <span id="currentStreak">0</span> å¤©</span>
              </div>
              <div class="streak-item">
                <i class="fas fa-trophy"></i>
                <span>æœ€é•¿ <span id="longestStreak">0</span> å¤©</span>
              </div>
            </div>
            
            <!-- æ—¥å†ç½‘æ ¼ -->
            <div class="calendar-grid">
              <div class="calendar-header">
                <div>æ—¥</div>
                <div>ä¸€</div>
                <div>äºŒ</div>
                <div>ä¸‰</div>
                <div>å››</div>
                <div>äº”</div>
                <div>å…­</div>
              </div>
              <div class="calendar-body" id="calendarBody">
                <!-- æ—¥å†æ—¥æœŸå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
              </div>
            </div>
            
            <!-- æœˆåº¦ç»Ÿè®¡ -->
            <div class="monthly-stats">
              <div class="stat-item">
                <div class="stat-value" id="completionRate">0%</div>
                <div class="stat-label">å®Œæˆç‡</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="totalDuration">0</div>
                <div class="stat-label">æ€»æ—¶é•¿(åˆ†é’Ÿ)</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="completedDays">0</div>
                <div class="stat-label">å®Œæˆå¤©æ•°</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- æˆå°±ç³»ç»Ÿ -->
      <div class="fitness-card">
        <div class="fitness-card-header">
          <i class="fas fa-trophy"></i>
          <h3 data-zh="æˆå°±ç³»ç»Ÿ" data-en="Achievements">æˆå°±ç³»ç»Ÿ</h3>
        </div>
        <div class="fitness-card-content">
          <div class="achievements" id="achievementsContainer">
            <div class="loading-message">æ­£åœ¨åŠ è½½æˆå°±æ•°æ®...</div>
          </div>
          <div class="achievement-stats" id="achievementStats">
            <div class="stat-item">
              <span class="stat-label">å·²è·å¾—æˆå°±:</span>
              <span class="stat-value" id="achievementCount">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">è¿ç»­æ‰“å¡:</span>
              <span class="stat-value" id="currentStreakStat">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">æ€»è®¡æ‰“å¡:</span>
              <span class="stat-value" id="totalCheckinsStat">0</span>
            </div>
          </div>
        </div>
      </div>

      <!-- å¥èº«ç¤¾åŒº -->
      <div class="fitness-card">
        <div class="fitness-card-header">
          <i class="fas fa-users"></i>
          <h3 data-zh="å¥èº«ç¤¾åŒº" data-en="Fitness Community">å¥èº«ç¤¾åŒº</h3>
          <button class="community-btn" onclick="openFitnessCommunity()" data-zh="è¿›å…¥ç¤¾åŒº" data-en="Join Community">
            <i class="fas fa-arrow-right"></i> è¿›å…¥ç¤¾åŒº
          </button>
        </div>
        <div class="fitness-card-content">
          <div class="community-preview">
            <div class="community-stats">
              <div class="stat-item">
                <div class="stat-value" id="communityMembers">0</div>
                <div class="stat-label">ç¤¾åŒºæˆå‘˜</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="communityPosts">0</div>
                <div class="stat-label">ä»Šæ—¥åŠ¨æ€</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="communityLikes">0</div>
                <div class="stat-label">ä»Šæ—¥ç‚¹èµ</div>
              </div>
            </div>
            <div class="community-features">
              <div class="feature-item">
                <i class="fas fa-share-alt"></i>
                <span>åˆ†äº«è®­ç»ƒæˆæœ</span>
              </div>
              <div class="feature-item">
                <i class="fas fa-trophy"></i>
                <span>å±•ç¤ºæˆå°±å¾½ç« </span>
              </div>
              <div class="feature-item">
                <i class="fas fa-users"></i>
                <span>å…³æ³¨å¥èº«è¾¾äºº</span>
              </div>
              <div class="feature-item">
                <i class="fas fa-comments"></i>
                <span>äº¤æµè®­ç»ƒå¿ƒå¾—</span>
              </div>
            </div>
            <div class="community-actions">
              <button class="action-btn primary" onclick="openFitnessCommunity()">
                <i class="fas fa-users"></i> æµè§ˆç¤¾åŒº
              </button>
              <button class="action-btn secondary" onclick="openFitnessProfile()">
                <i class="fas fa-user"></i> ä¸ªäººæ¡£æ¡ˆ
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- å¥èº«å·¥å…· -->
      <div class="fitness-card">
        <div class="fitness-card-header">
          <i class="fas fa-tools"></i>
          <h3 data-zh="å¥èº«å·¥å…·" data-en="Fitness Tools">å¥èº«å·¥å…·</h3>
          <button class="tools-btn" onclick="openFitnessTools()" data-zh="æ›´å¤šå·¥å…·" data-en="More Tools">
            <i class="fas fa-arrow-right"></i> æ›´å¤šå·¥å…·
          </button>
        </div>
        <div class="fitness-card-content">
          <div class="tools-grid">
            <div class="tool-item" onclick="openFitnessTools()">
              <i class="fas fa-stopwatch"></i>
              <span>è®­ç»ƒè®¡æ—¶å™¨</span>
            </div>
            <div class="tool-item" onclick="openFitnessTools()">
              <i class="fas fa-calculator"></i>
              <span>è¥å…»è®¡ç®—å™¨</span>
            </div>
            <div class="tool-item" onclick="openFitnessTools()">
              <i class="fas fa-chart-line"></i>
              <span>è¿›åº¦è¿½è¸ª</span>
            </div>
            <div class="tool-item" onclick="openFitnessTools()">
              <i class="fas fa-dumbbell"></i>
              <span>åŠ¨ä½œåº“</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.fitness-container {
  min-height: 100vh;
  background: var(--rage-bg, linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%));
  padding: 20px;
  position: relative;
}

.fitness-header {
  text-align: center;
  margin-bottom: 40px;
  padding: 40px 0;
}

.fitness-title {
  font-size: 3rem;
  font-weight: 900;
  color: var(--rage-primary, #ff6b35);
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 20px;
  text-shadow: 0 0 20px rgba(255, 107, 53, 0.5);
}

.fitness-title i {
  font-size: 2.5rem;
  animation: pulse 2s infinite;
}

.fitness-subtitle {
  font-size: 1.2rem;
  color: var(--rage-text-muted, #a8a8a8);
  font-family: var(--rage-font-mono, 'JetBrains Mono', monospace);
  text-transform: uppercase;
  letter-spacing: 2px;
}

.fitness-main {
  max-width: 1400px;
  margin: 0 auto;
}

.fitness-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 30px;
}

.fitness-card {
  background: var(--rage-gradient-card, linear-gradient(135deg, rgba(26,26,46,0.9) 0%, rgba(22,33,62,0.9) 100%));
  border: 2px solid var(--rage-border, rgba(255, 107, 53, 0.3));
  border-radius: 16px;
  overflow: hidden;
  transition: all 0.3s ease;
  position: relative;
}

.fitness-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 35px rgba(255, 107, 53, 0.3);
  border-color: var(--rage-primary, #ff6b35);
}

.fitness-card-header {
  background: var(--rage-gradient, linear-gradient(135deg, #ff6b35 0%, #f7931e 100%));
  color: #000;
  padding: 20px;
  display: flex;
  align-items: center;
  gap: 15px;
}

.fitness-card-header i {
  font-size: 1.5rem;
}

.fitness-card-header h3 {
  margin: 0;
  font-weight: 700;
  font-size: 1.3rem;
}

.fitness-card-content {
  padding: 25px;
}

/* è®­ç»ƒè®¡åˆ’æ ·å¼ */
.workout-plan {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.plan-day {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 15px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  border: 1px solid rgba(255, 107, 53, 0.2);
  transition: all 0.3s ease;
  cursor: pointer;
}

.plan-day:hover {
  background: rgba(255, 107, 53, 0.1);
  border-color: var(--rage-primary, #ff6b35);
}

.plan-day.active {
  background: var(--rage-primary, #ff6b35);
  color: #000;
  font-weight: 600;
}

.plan-type {
  font-size: 0.9rem;
  opacity: 0.8;
  font-weight: 600;
  flex: 1;
  text-align: center;
}

/* æ–°å¢çš„è®­ç»ƒè®¡åˆ’æ ·å¼ */
.current-plan-preview {
  width: 100%;
}

.plan-info {
  text-align: center;
  margin-bottom: 20px;
  padding: 15px;
  background: rgba(255, 107, 53, 0.1);
  border-radius: 8px;
  border: 1px solid rgba(255, 107, 53, 0.3);
}

.plan-info h4 {
  color: var(--rage-primary, #ff6b35);
  margin: 0 0 5px 0;
  font-size: 1.1rem;
}

.plan-info p {
  color: var(--rage-text-muted, #a8a8a8);
  margin: 0;
  font-size: 0.9rem;
}

.edit-plan-btn {
  background: var(--rage-primary, #ff6b35);
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 6px;
}

.edit-plan-btn:hover {
  background: var(--rage-secondary, #ff5722);
  transform: translateY(-2px);
}

.fitness-card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.plan-exercises {
  font-size: 0.8rem;
  color: var(--rage-text-muted, #a8a8a8);
  font-style: italic;
}

.plan-actions {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.action-btn {
  flex: 1;
  min-width: 120px;
  padding: 10px 15px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}

.action-btn.primary {
  background: var(--rage-primary, #ff6b35);
  color: white;
}

.action-btn.primary:hover {
  background: var(--rage-secondary, #ff5722);
  transform: translateY(-2px);
}

.action-btn.secondary {
  background: rgba(255, 255, 255, 0.1);
  color: var(--rage-text, #e6e6e6);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.action-btn.secondary:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(255, 255, 255, 0.3);
}

/* è®¡æ—¶å™¨æ ·å¼ */
.timer-display {
  text-align: center;
}

.timer-time {
  font-size: 3rem;
  font-weight: 900;
  color: var(--rage-primary, #ff6b35);
  font-family: var(--rage-font-mono, 'JetBrains Mono', monospace);
  margin-bottom: 20px;
  text-shadow: 0 0 10px rgba(255, 107, 53, 0.5);
}

.timer-controls {
  display: flex;
  gap: 10px;
  justify-content: center;
  margin-bottom: 20px;
}

.timer-btn {
  padding: 12px 24px;
  border: 2px solid var(--rage-primary, #ff6b35);
  background: transparent;
  color: var(--rage-primary, #ff6b35);
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  font-family: var(--rage-font-mono, 'JetBrains Mono', monospace);
}

.timer-btn:hover {
  background: var(--rage-primary, #ff6b35);
  color: #000;
  transform: translateY(-2px);
}

.timer-presets {
  display: flex;
  gap: 10px;
  justify-content: center;
  flex-wrap: wrap;
}

.preset-btn {
  padding: 8px 16px;
  border: 1px solid rgba(255, 107, 53, 0.3);
  background: rgba(255, 107, 53, 0.1);
  color: var(--rage-text, #e6e6e6);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 0.9rem;
}

.preset-btn:hover {
  background: var(--rage-primary, #ff6b35);
  color: #000;
}

/* è¿åŠ¨è®°å½•æ ·å¼ */
.workout-log {
  margin-bottom: 20px;
}

.log-entry {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid rgba(255, 107, 53, 0.2);
}

.log-entry:last-child {
  border-bottom: none;
}

.log-date {
  color: var(--rage-text-muted, #a8a8a8);
  font-size: 0.9rem;
}

.log-workout {
  color: var(--rage-primary, #ff6b35);
  font-weight: 600;
}

.log-duration {
  color: var(--rage-text, #e6e6e6);
  font-size: 0.9rem;
}

.add-log-btn {
  width: 100%;
  padding: 12px;
  background: var(--rage-primary, #ff6b35);
  color: #000;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
}

.add-log-btn:hover {
  background: #e55a2b;
  transform: translateY(-2px);
}

/* è¥å…»è®¡ç®—å™¨æ ·å¼ */
.nutrition-calc {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.calc-input {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.calc-input label {
  color: var(--rage-text, #e6e6e6);
  font-weight: 600;
  font-size: 0.9rem;
}

.calc-input input,
.calc-input select {
  padding: 10px;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 107, 53, 0.3);
  border-radius: 6px;
  color: var(--rage-text, #e6e6e6);
  font-family: var(--rage-font-mono, 'JetBrains Mono', monospace);
}

.calc-input input:focus,
.calc-input select:focus {
  outline: none;
  border-color: var(--rage-primary, #ff6b35);
}

.calc-btn {
  padding: 12px;
  background: var(--rage-primary, #ff6b35);
  color: #000;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
}

.calc-btn:hover {
  background: #e55a2b;
  transform: translateY(-2px);
}

.calc-result {
  padding: 15px;
  background: rgba(255, 107, 53, 0.1);
  border: 1px solid rgba(255, 107, 53, 0.3);
  border-radius: 8px;
  color: var(--rage-primary, #ff6b35);
  font-weight: 600;
  text-align: center;
  display: none;
}

/* è§†é¢‘ç½‘æ ¼æ ·å¼ */
.video-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
}

.video-item {
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
}

.video-item:hover {
  transform: translateY(-3px);
}

.video-thumbnail {
  width: 100%;
  height: 100px;
  background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 10px;
  position: relative;
  overflow: hidden;
}

.video-thumbnail i {
  font-size: 2rem;
  color: #000;
  z-index: 2;
}

.video-thumbnail::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.3);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.video-item:hover .video-thumbnail::before {
  opacity: 1;
}

.video-title {
  color: var(--rage-text, #e6e6e6);
  font-weight: 600;
  margin-bottom: 5px;
}

.video-duration {
  color: var(--rage-text-muted, #a8a8a8);
  font-size: 0.8rem;
}

/* æˆå°±ç³»ç»Ÿæ ·å¼ */
.achievements {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.achievement {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.achievement.unlocked {
  background: rgba(255, 107, 53, 0.1);
  border: 1px solid rgba(255, 107, 53, 0.3);
}

.achievement.locked {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  opacity: 0.5;
}

.achievement i {
  font-size: 1.5rem;
  color: var(--rage-primary, #ff6b35);
}

.achievement.locked i {
  color: var(--rage-text-muted, #a8a8a8);
}

.achievement-info {
  flex: 1;
}

.achievement-title {
  color: var(--rage-text, #e6e6e6);
  font-weight: 600;
  margin-bottom: 3px;
}

.achievement-desc {
  color: var(--rage-text-muted, #a8a8a8);
  font-size: 0.9rem;
}

.achievement-progress {
  margin-top: 8px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
  height: 6px;
  overflow: hidden;
}

.achievement-progress-bar {
  height: 100%;
  background: var(--rage-primary, #ff6b35);
  transition: width 0.3s ease;
}

.achievement-meta {
  text-align: right;
  font-size: 0.8rem;
  color: var(--rage-text-muted, #a8a8a8);
}

.loading-message {
  text-align: center;
  color: var(--rage-text-muted, #a8a8a8);
  padding: 20px;
}

.achievement-stats {
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
  padding: 15px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
}

.stat-item {
  text-align: center;
}

.stat-label {
  display: block;
  color: var(--rage-text-muted, #a8a8a8);
  font-size: 0.8rem;
  margin-bottom: 5px;
}

.stat-value {
  color: var(--rage-primary, #ff6b35);
  font-weight: 600;
  font-size: 1.1rem;
}

.timer-input {
  margin-bottom: 15px;
  text-align: center;
}

.timer-input label {
  display: block;
  color: var(--rage-text-muted, #a8a8a8);
  margin-bottom: 8px;
  font-size: 0.9rem;
}

.timer-input input {
  width: 120px;
  padding: 8px 12px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 6px;
  background: rgba(255, 255, 255, 0.1);
  color: var(--rage-text, #e6e6e6);
  text-align: center;
  margin-right: 10px;
}

.timer-input button {
  padding: 8px 16px;
  background: var(--rage-primary, #ff6b35);
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
}

.timer-input button:hover {
  background: var(--rage-secondary, #ff5722);
}



/* åŠ¨ç”» */
@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

/* å“åº”å¼è®¾è®¡ - ä¼˜åŒ–æŒ‰é’®æ˜¾ç¤º */
@media (max-width: 768px) {
  .fitness-grid {
    grid-template-columns: 1fr;
  }
  
  .fitness-title {
    font-size: 2rem;
  }
  
  .timer-time {
    font-size: 2rem;
  }
  
  .timer-controls {
    flex-direction: column;
    gap: 8px;
  }
  
  .timer-btn {
    padding: 10px 20px;
    font-size: 0.9rem;
  }
  
  .timer-presets {
    gap: 6px;
  }
  
  .preset-btn {
    padding: 6px 12px;
    font-size: 0.8rem;
  }
  
  .video-grid {
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  }
}

@media (max-width: 480px) {
  .timer-controls {
    gap: 6px;
  }
  
  .timer-btn {
    padding: 8px 16px;
    font-size: 0.85rem;
  }
  
  .timer-presets {
    gap: 4px;
  }
  
  .preset-btn {
    padding: 5px 10px;
    font-size: 0.75rem;
  }
  
  .fitness-container {
    padding: 10px;
  }
  
  .fitness-card-content {
    padding: 15px;
  }
}

@media (max-width: 360px) {
  .timer-controls {
    gap: 4px;
  }
  
  .timer-btn {
    padding: 6px 12px;
    font-size: 0.8rem;
  }
  
  .timer-presets {
    gap: 3px;
  }
  
  .preset-btn {
    padding: 4px 8px;
    font-size: 0.7rem;
  }
  
  .fitness-container {
    padding: 5px;
  }
  
  .fitness-card-content {
    padding: 10px;
  }
}

/* å¿«æ·é”®æç¤ºæ ·å¼ */
.theme-switch-hint {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
  background: rgba(255,255,255,0.95);
  padding: 12px 16px;
  border-radius: 8px;
  border: 1px solid rgba(102, 126, 234, 0.3);
  backdrop-filter: blur(10px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
}

.theme-switch-hint:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.hint-content {
  display: flex;
  align-items: center;
  gap: 8px;
  font-family: 'Arial', sans-serif;
  font-size: 0.9rem;
  color: #667eea;
  font-weight: 600;
}

.hint-content i {
  font-size: 1rem;
  color: #764ba2;
}

.hint-content span {
  white-space: nowrap;
}

.help-btn {
  background: rgba(102, 126, 234, 0.1);
  border: 1px solid rgba(102, 126, 234, 0.3);
  color: #667eea;
  border-radius: 4px;
  padding: 4px 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-left: 8px;
}

.help-btn:hover {
  background: rgba(102, 126, 234, 0.2);
  transform: scale(1.1);
}

/* å¿«æ·é”®å¸®åŠ©æŒ‰é’®æ ·å¼ */
.shortcuts-help-btn {
  position: fixed;
  top: 20px;
  right: 20px;
  background: var(--rage-gradient, linear-gradient(135deg, #ff6b35 0%, #f7931e 100%));
  border: none;
  color: #000;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
  transition: all 0.3s ease;
  z-index: 1000;
}

.shortcuts-help-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
}

/* å¿«æ·é”®å¸®åŠ©é¢æ¿æ ·å¼ */
.shortcuts-help-panel {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.8);
  background: rgba(255,255,255,0.98);
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(102, 126, 234, 0.2);
  z-index: 10000;
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow: hidden;
  opacity: 0;
  visibility: hidden;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.shortcuts-help-panel.show {
  opacity: 1;
  visibility: visible;
  transform: translate(-50%, -50%) scale(1);
}

.help-panel-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-radius: 16px 16px 0 0;
}

.help-panel-header h3 {
  margin: 0;
  font-size: 1.2rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 10px;
}

.close-help-btn {
  background: rgba(255,255,255,0.2);
  border: none;
  color: white;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.close-help-btn:hover {
  background: rgba(255,255,255,0.3);
  transform: scale(1.1);
}

.help-panel-content {
  padding: 20px;
  max-height: 60vh;
  overflow-y: auto;
}

.shortcuts-section {
  margin-bottom: 25px;
}

.shortcuts-section h4 {
  color: #667eea;
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
  border-bottom: 2px solid rgba(102, 126, 234, 0.2);
  padding-bottom: 8px;
}

.shortcut-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid rgba(0,0,0,0.05);
  transition: all 0.3s ease;
}

.shortcut-item:hover {
  background: rgba(102, 126, 234, 0.05);
  padding-left: 10px;
  border-radius: 6px;
}

.shortcut-key {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 6px 12px;
  border-radius: 6px;
  font-family: 'Courier New', monospace;
  font-weight: 600;
  font-size: 0.85rem;
  min-width: 80px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.shortcut-desc {
  color: #333;
  font-weight: 500;
  flex: 1;
  margin-left: 15px;
}

/* é®ç½©å±‚ */
.help-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.help-overlay.show {
  opacity: 1;
  visibility: visible;
}

/* æ‰“å¡æ—¥å†æ ·å¼ */
.checkin-calendar-container {
  padding: 20px;
}

.calendar-nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
  gap: 10px;
}

.nav-btn {
  background: var(--rage-gradient, linear-gradient(135deg, #ff6b35 0%, #f7931e 100%));
  border: none;
  color: #000;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s ease;
}

.nav-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
}

.today-btn {
  background: var(--rage-primary, #ff6b35);
  color: white;
}

.current-month {
  font-size: 1.2rem;
  font-weight: bold;
  color: var(--rage-primary, #ff6b35);
  text-align: center;
  flex: 1;
}

.streak-info {
  display: flex;
  justify-content: space-around;
  margin-bottom: 20px;
  padding: 15px;
  background: rgba(255, 107, 53, 0.1);
  border-radius: 10px;
  border: 1px solid rgba(255, 107, 53, 0.3);
}

.streak-item {
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--rage-primary, #ff6b35);
  font-weight: bold;
}

.streak-item i {
  font-size: 1.2rem;
  animation: flame 1.5s ease-in-out infinite alternate;
}

@keyframes flame {
  0% { transform: scale(1); }
  100% { transform: scale(1.1); }
}

.calendar-grid {
  margin-bottom: 20px;
}

.calendar-header {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 2px;
  margin-bottom: 10px;
}

.calendar-header > div {
  text-align: center;
  font-weight: bold;
  color: var(--rage-primary, #ff6b35);
  padding: 10px;
  font-size: 0.9rem;
}

.calendar-body {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 2px;
}

.calendar-day {
  aspect-ratio: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 107, 53, 0.2);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: bold;
  position: relative;
  overflow: hidden;
}

.calendar-day:hover {
  background: rgba(255, 107, 53, 0.2);
  transform: scale(1.05);
  z-index: 2;
}

.calendar-day.other-month {
  opacity: 0.3;
  background: rgba(255, 255, 255, 0.02);
}

.calendar-day.today {
  background: var(--rage-gradient, linear-gradient(135deg, #ff6b35 0%, #f7931e 100%));
  color: #000;
  border-color: var(--rage-primary, #ff6b35);
  box-shadow: 0 0 15px rgba(255, 107, 53, 0.5);
}

.calendar-day.completed {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
  color: white;
  border-color: #28a745;
}

.calendar-day.completed::after {
  content: 'âœ“';
  position: absolute;
  top: 2px;
  right: 2px;
  font-size: 0.8rem;
  color: white;
}

.calendar-day.rest {
  background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
  color: white;
  border-color: #6c757d;
}

.calendar-day.rest::after {
  content: 'ğŸ˜´';
  position: absolute;
  top: 2px;
  right: 2px;
  font-size: 0.8rem;
}

.monthly-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
  margin-top: 20px;
}

.stat-item {
  text-align: center;
  padding: 15px;
  background: rgba(255, 107, 53, 0.1);
  border-radius: 10px;
  border: 1px solid rgba(255, 107, 53, 0.3);
}

.stat-value {
  font-size: 1.5rem;
  font-weight: bold;
  color: var(--rage-primary, #ff6b35);
  margin-bottom: 5px;
}

.stat-label {
  font-size: 0.9rem;
  color: var(--rage-text-muted, #a8a8a8);
}

/* æ‰“å¡æ¨¡æ€æ¡†æ ·å¼ */
.checkin-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  backdrop-filter: blur(5px);
}

.checkin-modal-content {
  background: var(--rage-gradient-card, linear-gradient(135deg, rgba(26,26,46,0.95) 0%, rgba(22,33,62,0.95) 100%));
  border: 2px solid var(--rage-border, rgba(255, 107, 53, 0.3));
  border-radius: 16px;
  padding: 30px;
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  color: white;
}

.checkin-modal-content h3 {
  color: var(--rage-primary, #ff6b35);
  margin-bottom: 20px;
  text-align: center;
  font-size: 1.5rem;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  color: var(--rage-text-muted, #a8a8a8);
  font-weight: bold;
}

.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 12px;
  border: 1px solid rgba(255, 107, 53, 0.3);
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.1);
  color: white;
  font-size: 14px;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  outline: none;
  border-color: var(--rage-primary, #ff6b35);
  box-shadow: 0 0 10px rgba(255, 107, 53, 0.3);
}

.form-group input::placeholder,
.form-group textarea::placeholder {
  color: rgba(255, 255, 255, 0.5);
}

/* è®­ç»ƒéƒ¨ä½é€‰æ‹©æ ·å¼ */
.training-parts-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
  gap: 10px;
  margin-top: 8px;
}

.checkbox-label {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  border: 1px solid rgba(255, 107, 53, 0.3);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 14px;
  background: rgba(255, 255, 255, 0.05);
  color: white;
}

.checkbox-label:hover {
  border-color: var(--rage-primary, #ff6b35);
  background: rgba(255, 107, 53, 0.1);
}

.checkbox-label input[type="checkbox"]:checked + span {
  color: var(--rage-primary, #ff6b35);
  font-weight: 600;
}

.checkbox-label input[type="checkbox"] {
  margin: 0;
  accent-color: var(--rage-primary, #ff6b35);
}

/* æ˜Ÿçº§è¯„åˆ†æ ·å¼ */
.rating-container {
  margin-top: 8px;
}

.star-rating {
  display: flex;
  flex-direction: row-reverse;
  gap: 2px;
}

.star-rating input[type="radio"] {
  display: none;
}

.star-rating label {
  font-size: 24px;
  color: rgba(255, 255, 255, 0.3);
  cursor: pointer;
  transition: color 0.3s ease;
}

.star-rating label:hover,
.star-rating label:hover ~ label,
.star-rating input[type="radio"]:checked ~ label {
  color: #ffd700;
}

.star-rating input[type="radio"]:checked ~ label {
  color: #ffd700;
}

.checkin-detail {
  background: rgba(255, 255, 255, 0.05);
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 20px;
}

.checkin-detail p {
  margin-bottom: 10px;
  line-height: 1.6;
}

.checkin-detail strong {
  color: var(--rage-primary, #ff6b35);
}

.form-actions {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  margin-top: 20px;
}

.btn-cancel,
.btn-submit,
.btn-edit,
.btn-delete {
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s ease;
}

.btn-cancel {
  background: rgba(255, 255, 255, 0.1);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.btn-submit,
.btn-edit {
  background: var(--rage-gradient, linear-gradient(135deg, #ff6b35 0%, #f7931e 100%));
  color: #000;
}

.btn-delete {
  background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
  color: white;
}

.btn-cancel:hover,
.btn-submit:hover,
.btn-edit:hover,
.btn-delete:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .calendar-nav {
    flex-wrap: wrap;
    gap: 5px;
  }
  
  .nav-btn {
    padding: 6px 10px;
    font-size: 0.9rem;
  }
  
  .current-month {
    font-size: 1rem;
    order: -1;
    width: 100%;
    margin-bottom: 10px;
  }
  
  .streak-info {
    flex-direction: column;
    gap: 10px;
  }
  
  .monthly-stats {
    grid-template-columns: 1fr;
  }
  
  .checkin-modal-content {
    padding: 20px;
    margin: 20px;
  }
  
  .form-actions {
    flex-direction: column;
  }
}

.community-preview {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.community-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
}

.community-features {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
}

.feature-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px;
  background: rgba(255, 107, 53, 0.1);
  border-radius: 8px;
  border: 1px solid rgba(255, 107, 53, 0.3);
}

.feature-item i {
  color: var(--rage-primary, #ff6b35);
  font-size: 1.2rem;
}

.feature-item span {
  color: var(--rage-text, #e6e6e6);
  font-size: 0.9rem;
}

.community-actions {
  display: flex;
  gap: 10px;
  justify-content: center;
}

/* å¥èº«å·¥å…·æ ·å¼ */
.tools-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
}

.tool-item {
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  padding: 20px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  border: 1px solid rgba(255, 107, 53, 0.2);
}

.tool-item:hover {
  transform: translateY(-3px);
  background: rgba(255, 107, 53, 0.1);
  border-color: var(--rage-primary, #ff6b35);
}

.tool-item i {
  font-size: 2rem;
  color: var(--rage-primary, #ff6b35);
  margin-bottom: 10px;
  display: block;
}

.tool-item span {
  font-size: 0.9rem;
  color: var(--rage-text, #e6e6e6);
  font-weight: 600;
}

/* æŒ‰é’®æ ·å¼ */
.community-btn,
.tools-btn {
  background: var(--rage-primary, #ff6b35);
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 6px;
}

.community-btn:hover,
.tools-btn:hover {
  background: var(--rage-secondary, #ff5722);
  transform: translateY(-2px);
}
</style>

<script>
// å¿«æ·é”®æ”¯æŒ
document.addEventListener('keydown', function(e) {
  // åªåœ¨éè¾“å…¥æ¡†ä¸­å“åº”å¿«æ·é”®
  if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
    return;
  }
  
  // Ctrl/Cmd + æ•°å­—é”®åˆ‡æ¢ä¸»é¢˜
  if ((e.ctrlKey || e.metaKey) && !e.shiftKey && !e.altKey) {
    switch(e.key) {
      case '1':
        e.preventDefault();
        window.location.href = '/tools/life_diary/';
        break;
      case '2':
        e.preventDefault();
        window.location.href = '/tools/creative_writer/';
        break;
      case '3':
        e.preventDefault();
        window.location.href = '/tools/fitness/';
        break;
      case '4':
        e.preventDefault();
        window.location.href = '/tools/emo_diary/';
        break;
    }
  }
  
  // Alt + å­—æ¯é”®è·³è½¬åˆ°å·¥å…·é¡µé¢
  if (e.altKey && !e.ctrlKey && !e.metaKey && !e.shiftKey) {
    switch(e.key.toLowerCase()) {
      case 'e':
        e.preventDefault();
        window.location.href = '/tools/emo_diary/';
        break;
      case 'l':
        e.preventDefault();
        window.location.href = '/tools/life_diary/';
        break;
      case 'f':
        e.preventDefault();
        window.location.href = '/tools/fitness/';
        break;
      case 'c':
        e.preventDefault();
        window.location.href = '/tools/creative_writer/';
        break;
      case 'p':
        e.preventDefault();
        window.location.href = '/tools/pdf_converter/';
        break;
      case 'r':
        e.preventDefault();
        // window.location.href = '/tools/redbook_generator/'; // å·²éšè—
        break;
      case 't':
        e.preventDefault();
        window.location.href = '/tools/test_case_generator/';
        break;
      case 'w':
        e.preventDefault();
        window.location.href = '/tools/web_crawler/';
        break;
      case 's':
        e.preventDefault();
        window.location.href = '{% url "tools:self_analysis" %}';
        break;
      case 'b':
        e.preventDefault();
        window.location.href = '/tools/storyboard/';
        break;
      case 'm':
        e.preventDefault();
        window.location.href = '/tools/music_healing/';
        break;
      case 'd':
        e.preventDefault();
        window.location.href = '/tools/meditation_guide/';
        break;
      case 'a':
        e.preventDefault();
        window.location.href = '/tools/fortune_analyzer/';
        break;
    }
  }
});

// åˆå§‹åŒ–å¿«æ·é”®å¸®åŠ©é¢æ¿
function initShortcutsHelp() {
  const helpBtn = document.getElementById('showShortcutsHelp');
  const helpPanel = document.getElementById('shortcutsHelpPanel');
  const closeBtn = document.getElementById('closeShortcutsHelp');
  const overlay = document.getElementById('helpOverlay');
  
  // æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨
  if (!helpBtn || !helpPanel || !closeBtn || !overlay) {
    console.warn('å¿«æ·é”®å¸®åŠ©é¢æ¿å…ƒç´ æœªæ‰¾åˆ°ï¼Œè·³è¿‡åˆå§‹åŒ–');
    return;
  }
  
  // æ˜¾ç¤ºå¸®åŠ©é¢æ¿
  helpBtn.addEventListener('click', function() {
    helpPanel.classList.add('show');
    overlay.classList.add('show');
    document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
  });
  
  // å…³é—­å¸®åŠ©é¢æ¿
  function closeHelpPanel() {
    helpPanel.classList.remove('show');
    overlay.classList.remove('show');
    document.body.style.overflow = ''; // æ¢å¤æ»šåŠ¨
  }
  
  closeBtn.addEventListener('click', closeHelpPanel);
  overlay.addEventListener('click', closeHelpPanel);
  
  // ESCé”®å…³é—­å¸®åŠ©é¢æ¿
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && helpPanel.classList.contains('show')) {
      closeHelpPanel();
    }
  });
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
  initShortcutsHelp();
});



// è®­ç»ƒè®¡åˆ’äº¤äº’
document.querySelectorAll('.plan-day').forEach(day => {
  day.addEventListener('click', function() {
    document.querySelectorAll('.plan-day').forEach(d => d.classList.remove('active'));
    this.classList.add('active');
  });
});

// è®¡æ—¶å™¨åŠŸèƒ½
let timerInterval;
let timeLeft = 0;
let isRunning = false;

// è®¾ç½®è®¡æ—¶å™¨æŒ‰é’®äº‹ä»¶
const setTimerBtn = document.getElementById('setTimer');
if (setTimerBtn) {
  setTimerBtn.addEventListener('click', function() {
    const timerSecondsEl = document.getElementById('timerSeconds');
    if (!timerSecondsEl) return;
    
    const seconds = parseInt(timerSecondsEl.value);
    if (seconds && seconds > 0 && seconds <= 7200) {
      timeLeft = seconds;
      updateTimerDisplay();
      const startTimerEl = document.getElementById('startTimer');
      if (startTimerEl) {
        startTimerEl.textContent = 'å¼€å§‹';
      }
      if (isRunning) {
        isRunning = false;
        clearInterval(timerInterval);
      }
    } else {
      alert('è¯·è¾“å…¥1-7200ä¹‹é—´çš„ç§’æ•°');
    }
  });
}

const startTimerBtn = document.getElementById('startTimer');
if (startTimerBtn) {
  startTimerBtn.addEventListener('click', function() {
    if (!isRunning && timeLeft > 0) {
      isRunning = true;
      timerInterval = setInterval(updateTimer, 1000);
      this.textContent = 'æš‚åœ';
    } else if (isRunning) {
      isRunning = false;
      clearInterval(timerInterval);
      this.textContent = 'ç»§ç»­';
    }
  });
}

const pauseTimerBtn = document.getElementById('pauseTimer');
if (pauseTimerBtn) {
  pauseTimerBtn.addEventListener('click', function() {
    if (isRunning) {
      isRunning = false;
      clearInterval(timerInterval);
      const startTimerEl = document.getElementById('startTimer');
      if (startTimerEl) {
        startTimerEl.textContent = 'ç»§ç»­';
      }
    }
  });
}

const resetTimerBtn = document.getElementById('resetTimer');
if (resetTimerBtn) {
  resetTimerBtn.addEventListener('click', function() {
    isRunning = false;
    clearInterval(timerInterval);
    timeLeft = 0;
    updateTimerDisplay();
    const startTimerEl = document.getElementById('startTimer');
    if (startTimerEl) {
      startTimerEl.textContent = 'å¼€å§‹';
    }
  });
}

document.querySelectorAll('.preset-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    timeLeft = parseInt(this.getAttribute('data-time'));
    updateTimerDisplay();
  });
});

function updateTimer() {
  if (timeLeft > 0) {
    timeLeft--;
    updateTimerDisplay();
  } else {
    isRunning = false;
    clearInterval(timerInterval);
    alert('è®­ç»ƒå®Œæˆï¼');
  }
}

function updateTimerDisplay() {
  const minutes = Math.floor(timeLeft / 60);
  const seconds = timeLeft % 60;
  document.getElementById('timerDisplay').textContent = 
    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

// è¥å…»è®¡ç®—å™¨åŠŸèƒ½
document.getElementById('calculateBMR').addEventListener('click', function() {
  const weight = parseFloat(document.getElementById('weight').value);
  const height = parseFloat(document.getElementById('height').value);
  const age = parseFloat(document.getElementById('age').value);
  const activity = parseFloat(document.getElementById('activity').value);
  
  if (weight && height && age) {
    // ä½¿ç”¨Mifflin-St Jeorå…¬å¼è®¡ç®—BMR
    const bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
    const tdee = bmr * activity;
    
    const resultText = `åŸºç¡€ä»£è°¢ç‡: ${Math.round(bmr)} åƒå¡/å¤©\næ¯æ—¥æ€»æ¶ˆè€—: ${Math.round(tdee)} åƒå¡/å¤©`;
    
    document.getElementById('bmrResult').textContent = resultText;
    document.getElementById('bmrResult').style.display = 'block';
  }
});

// è§†é¢‘ç‚¹å‡»äº‹ä»¶
document.querySelectorAll('.video-item').forEach(item => {
  item.addEventListener('click', function() {
    const title = this.querySelector('.video-title').textContent;
    alert(`å¼€å§‹æ’­æ”¾è§†é¢‘: ${title}`);
  });
});

// æ‰“å¡æ—¥å†åŠŸèƒ½
class CheckInCalendar {
  constructor() {
    this.currentDate = new Date();
    this.currentYear = this.currentDate.getFullYear();
    this.currentMonth = this.currentDate.getMonth();
    this.calendarData = {};
    this.streak = { current: 0, longest: 0 };
    this.monthlyStats = {};
    
    this.init();
  }
  
  async init() {
    await this.loadCalendarData();
    this.renderCalendar();
    this.bindEvents();
    this.updateStats();
    await this.loadAchievements();
  }
  
  async loadCalendarData() {
    try {
      const response = await fetch(`/tools/api/checkin/calendar/?type=fitness&year=${this.currentYear}&month=${this.currentMonth + 1}`);
      const data = await response.json();
      
      if (data.success) {
        this.calendarData = data.calendar_data || {};
        this.streak = data.streak || { current: 0, longest: 0 };
        this.monthlyStats = data.monthly_stats || {};
      }
    } catch (error) {
      console.error('åŠ è½½æ—¥å†æ•°æ®å¤±è´¥:', error);
      // è®¾ç½®é»˜è®¤å€¼
      this.calendarData = {};
      this.streak = { current: 0, longest: 0 };
      this.monthlyStats = {};
    }
  }
  
  renderCalendar() {
    const firstDay = new Date(this.currentYear, this.currentMonth, 1);
    const lastDay = new Date(this.currentYear, this.currentMonth + 1, 0);
    const startDate = new Date(firstDay);
    startDate.setDate(startDate.getDate() - firstDay.getDay());
    
    const calendarBody = document.getElementById('calendarBody');
    if (!calendarBody) return;
    
    calendarBody.innerHTML = '';
    
    // æ›´æ–°æœˆä»½æ˜¾ç¤º
    const currentMonthEl = document.getElementById('currentMonth');
    if (currentMonthEl) {
      currentMonthEl.textContent = `${this.currentYear}å¹´${this.currentMonth + 1}æœˆ`;
    }
    
    // æ›´æ–°è¿ç»­æ‰“å¡ä¿¡æ¯
    const currentStreakEl = document.getElementById('currentStreak');
    const longestStreakEl = document.getElementById('longestStreak');
    
    if (currentStreakEl) {
      currentStreakEl.textContent = this.streak.current || 0;
    }
    if (longestStreakEl) {
      longestStreakEl.textContent = this.streak.longest || 0;
    }
    
    // ç”Ÿæˆæ—¥å†ç½‘æ ¼
    for (let i = 0; i < 42; i++) {
      const date = new Date(startDate);
      date.setDate(startDate.getDate() + i);
      
      const dayElement = document.createElement('div');
      dayElement.className = 'calendar-day';
      
      const dateStr = date.toISOString().split('T')[0];
      const isCurrentMonth = date.getMonth() === this.currentMonth;
      const isToday = date.toDateString() === new Date().toDateString();
      const checkinData = this.calendarData[dateStr];
      
      if (!isCurrentMonth) {
        dayElement.classList.add('other-month');
      }
      
      if (isToday) {
        dayElement.classList.add('today');
      }
      
      if (checkinData) {
        dayElement.classList.add('has-checkin');
        if (checkinData.status === 'completed') {
          dayElement.classList.add('completed');
        } else if (checkinData.status === 'rest') {
          dayElement.classList.add('rest');
        }
      }
      
      dayElement.textContent = date.getDate();
      dayElement.setAttribute('data-date', dateStr);
      
      dayElement.addEventListener('click', () => this.handleDayClick(dateStr, checkinData));
      
      calendarBody.appendChild(dayElement);
    }
  }
  
  async handleDayClick(dateStr, checkinData) {
    const clickedDate = new Date(dateStr);
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    // æ£€æŸ¥æ˜¯å¦ä¸ºæœªæ¥æ—¥æœŸ
    if (clickedDate > today) {
      this.showNotification('ä¸èƒ½ä¸ºæœªæ¥æ—¥æœŸæ‰“å¡', 'error');
      return;
    }
    
    if (checkinData) {
      // æ˜¾ç¤ºæ‰“å¡è¯¦æƒ…
      this.showCheckinDetail(dateStr, checkinData);
    } else {
      // æ£€æŸ¥æ˜¯å¦ä¸ºè¿‡å»çš„æ—¥æœŸ
      if (clickedDate < today) {
        // æ˜¾ç¤ºäºŒæ¬¡ç¡®è®¤å¯¹è¯æ¡†
        this.showPastDateConfirmation(dateStr);
      } else {
        // ä»Šå¤©çš„æ—¥æœŸï¼Œç›´æ¥æ˜¾ç¤ºæ‰“å¡è¡¨å•
        this.showCheckinForm(dateStr);
      }
    }
  }

  showPastDateConfirmation(dateStr) {
    const confirmation = `
      <div class="checkin-modal">
        <div class="checkin-modal-content">
          <h3>ç¡®è®¤è¡¥æ‰“å¡</h3>
          <div class="confirmation-message">
            <i class="fas fa-exclamation-triangle" style="color: #ff6b35; font-size: 2rem; margin-bottom: 15px;"></i>
            <p>æ‚¨æ­£åœ¨ä¸º <strong>${dateStr}</strong> è¡¥æ‰“å¡ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¥æœŸã€‚</p>
            <p>è¯·ç¡®è®¤æ‚¨ç¡®å®åœ¨è¿™ä¸€å¤©è¿›è¡Œäº†å¥èº«æ´»åŠ¨ã€‚</p>
          </div>
          <div class="form-actions">
            <button class="btn-cancel">å–æ¶ˆ</button>
            <button class="btn-confirm">ç¡®è®¤è¡¥æ‰“å¡</button>
          </div>
        </div>
      </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', confirmation);
    
    const modal = document.querySelector('.checkin-modal');
    
    modal.querySelector('.btn-cancel').addEventListener('click', () => {
      modal.remove();
    });
    
    modal.querySelector('.btn-confirm').addEventListener('click', () => {
      modal.remove();
      this.showCheckinForm(dateStr);
    });
    
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.remove();
      }
    });
  }

  showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.innerHTML = `
      <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
      <span>${message}</span>
    `;
    
    Object.assign(notification.style, {
      position: 'fixed',
      top: '20px',
      right: '20px',
      padding: '12px 20px',
      borderRadius: '6px',
      color: 'white',
      fontSize: '14px',
      fontWeight: '500',
      zIndex: '10000',
      display: 'flex',
      alignItems: 'center',
      gap: '8px',
      minWidth: '250px',
      boxShadow: '0 4px 12px rgba(0,0,0,0.15)',
      backgroundColor: type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3',
      animation: 'slideInRight 0.3s ease-out'
    });
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.style.animation = 'slideOutRight 0.3s ease-in';
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 300);
    }, 3000);
  }
  
  showCheckinForm(dateStr) {
    const form = `
      <div class="checkin-modal">
        <div class="checkin-modal-content">
          <h3>æ·»åŠ å¥èº«æ‰“å¡ - ${dateStr}</h3>
          <form id="checkinForm">
            <div class="form-group">
              <label>è¿åŠ¨ç±»å‹</label>
              <select name="workout_type" required>
                <option value="strength">åŠ›é‡è®­ç»ƒ</option>
                <option value="cardio">æœ‰æ°§è®­ç»ƒ</option>
                <option value="yoga">ç‘œä¼½</option>
                <option value="hiit">é«˜å¼ºåº¦é—´æ­‡</option>
                <option value="flexibility">æŸ”éŸ§æ€§è®­ç»ƒ</option>
                <option value="other">å…¶ä»–</option>
              </select>
            </div>
            <div class="form-group">
              <label>ğŸ’ª è®­ç»ƒéƒ¨ä½</label>
              <div class="training-parts-container">
                <label class="checkbox-label">
                  <input type="checkbox" name="training_parts" value="èƒ¸"> èƒ¸
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="training_parts" value="èƒŒ"> èƒŒ
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="training_parts" value="è…¿"> è…¿
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="training_parts" value="è‚©"> è‚©
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="training_parts" value="æ‰‹è‡‚"> æ‰‹è‡‚
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="training_parts" value="æ ¸å¿ƒ"> æ ¸å¿ƒ
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="training_parts" value="å…¨èº«"> å…¨èº«
                </label>
              </div>
            </div>
            <div class="form-group">
              <label>æŒç»­æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
              <input type="number" name="duration" min="1" max="300" required>
            </div>
            <div class="form-group">
              <label>å¼ºåº¦</label>
              <select name="intensity" required>
                <option value="low">ä½</option>
                <option value="medium">ä¸­</option>
                <option value="high">é«˜</option>
              </select>
            </div>
            <div class="form-group">
              <label>ğŸ”¥ æ„Ÿå—è¯„åˆ†</label>
              <div class="rating-container">
                <div class="star-rating">
                  <input type="radio" name="feeling_rating" value="1" id="star1">
                  <label for="star1">â­</label>
                  <input type="radio" name="feeling_rating" value="2" id="star2">
                  <label for="star2">â­</label>
                  <input type="radio" name="feeling_rating" value="3" id="star3">
                  <label for="star3">â­</label>
                  <input type="radio" name="feeling_rating" value="4" id="star4">
                  <label for="star4">â­</label>
                  <input type="radio" name="feeling_rating" value="5" id="star5">
                  <label for="star5">â­</label>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label>å¤‡æ³¨</label>
              <textarea name="notes" rows="3"></textarea>
            </div>
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" name="is_shared_to_community" value="true">
                ğŸ“¢ ä¸€é”®åˆ†äº«åˆ°ç¤¾åŒº
              </label>
            </div>
            <div class="form-actions">
              <button type="button" class="btn-cancel">å–æ¶ˆ</button>
              <button type="submit" class="btn-submit">ä¿å­˜</button>
            </div>
          </form>
        </div>
      </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', form);
    
    const modal = document.querySelector('.checkin-modal');
    const formElement = document.getElementById('checkinForm');
    
    formElement.addEventListener('submit', (e) => {
      e.preventDefault();
      this.submitCheckin(dateStr, formElement);
    });
    
    modal.querySelector('.btn-cancel').addEventListener('click', () => {
      modal.remove();
    });
    
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.remove();
      }
    });
  }
  
  showCheckinDetail(dateStr, checkinData) {
    const detail = `
      <div class="checkin-modal">
        <div class="checkin-modal-content">
          <h3>æ‰“å¡è¯¦æƒ… - ${dateStr}</h3>
          <div class="checkin-detail">
            <p><strong>çŠ¶æ€:</strong> ${checkinData.status === 'completed' ? 'å·²å®Œæˆ' : 'ä¼‘æ¯æ—¥'}</p>
            ${checkinData.detail ? `
              <p><strong>è¿åŠ¨ç±»å‹:</strong> ${this.getWorkoutTypeName(checkinData.detail.workout_type)}</p>
              <p><strong>æŒç»­æ—¶é—´:</strong> ${checkinData.detail.duration} åˆ†é’Ÿ</p>
              <p><strong>å¼ºåº¦:</strong> ${this.getIntensityName(checkinData.detail.intensity)}</p>
              <p><strong>å¤‡æ³¨:</strong> ${checkinData.detail.notes || 'æ— '}</p>
            ` : ''}
          </div>
          <div class="form-actions">
            <button class="btn-edit">ç¼–è¾‘</button>
            <button class="btn-delete">åˆ é™¤</button>
            <button class="btn-cancel">å…³é—­</button>
          </div>
        </div>
      </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', detail);
    
    const modal = document.querySelector('.checkin-modal');
    
    modal.querySelector('.btn-cancel').addEventListener('click', () => {
      modal.remove();
    });
    
    modal.querySelector('.btn-delete').addEventListener('click', () => {
      if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡æ‰“å¡è®°å½•å—ï¼Ÿ')) {
        this.deleteCheckin(dateStr);
        modal.remove();
      }
    });
    
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.remove();
      }
    });
  }
  
  async submitCheckin(dateStr, form) {
    const formData = new FormData(form);
    
    // è·å–è®­ç»ƒéƒ¨ä½ï¼ˆå¤šé€‰ï¼‰
    const trainingParts = [];
    form.querySelectorAll('input[name="training_parts"]:checked').forEach(checkbox => {
      trainingParts.push(checkbox.value);
    });
    
    // è·å–æ„Ÿå—è¯„åˆ†
    const feelingRating = form.querySelector('input[name="feeling_rating"]:checked');
    const rating = feelingRating ? parseInt(feelingRating.value) : null;
    
    // è·å–æ˜¯å¦åˆ†äº«åˆ°ç¤¾åŒº
    const isSharedToCommunity = form.querySelector('input[name="is_shared_to_community"]').checked;
    
    const data = {
      type: 'fitness',
      date: dateStr,
      status: 'completed',
      detail: {
        workout_type: formData.get('workout_type'),
        duration: parseInt(formData.get('duration')),
        intensity: formData.get('intensity'),
        training_parts: trainingParts,
        feeling_rating: rating,
        is_shared_to_community: isSharedToCommunity,
        notes: formData.get('notes')
      }
    };
    
    try {
      const response = await fetch('/tools/api/checkin/add/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify(data)
      });
      
      const result = await response.json();
      
      if (result.success) {
        // å¦‚æœé€‰æ‹©åˆ†äº«åˆ°ç¤¾åŒºï¼Œåˆ›å»ºç¤¾åŒºå¸–å­
        if (isSharedToCommunity) {
          await this.createCommunityPost(dateStr, data.detail);
        }
        
        await this.loadCalendarData();
        this.renderCalendar();
        this.updateStats();
        document.querySelector('.checkin-modal').remove();
        alert('æ‰“å¡æˆåŠŸï¼');
      } else {
        alert('æ‰“å¡å¤±è´¥: ' + result.error);
      }
    } catch (error) {
      console.error('æäº¤æ‰“å¡å¤±è´¥:', error);
      alert('æ‰“å¡å¤±è´¥ï¼Œè¯·é‡è¯•');
    }
  }
  
  async createCommunityPost(dateStr, detailData) {
    try {
      const workoutTypeNames = {
        'strength': 'åŠ›é‡è®­ç»ƒ',
        'cardio': 'æœ‰æ°§è®­ç»ƒ',
        'yoga': 'ç‘œä¼½',
        'hiit': 'é«˜å¼ºåº¦é—´æ­‡',
        'flexibility': 'æŸ”éŸ§æ€§è®­ç»ƒ',
        'other': 'å…¶ä»–'
      };
      
      const intensityNames = {
        'low': 'ä½å¼ºåº¦',
        'medium': 'ä¸­ç­‰å¼ºåº¦',
        'high': 'é«˜å¼ºåº¦'
      };
      
      const title = `ä»Šæ—¥å¥èº«æ‰“å¡ - ${workoutTypeNames[detailData.workout_type]}`;
      const content = `ğŸ’ª è®­ç»ƒéƒ¨ä½ï¼š${detailData.training_parts.join('ã€') || 'å…¨èº«'}
ğŸ”¥ æ„Ÿå—ï¼š${'â­'.repeat(detailData.feeling_rating || 0)}
â±ï¸ æ—¶é•¿ï¼š${detailData.duration}åˆ†é’Ÿ
ğŸ’ª å¼ºåº¦ï¼š${intensityNames[detailData.intensity]}
ğŸ“ å¤‡æ³¨ï¼š${detailData.notes || 'æ— '}

ç»§ç»­åŠ æ²¹ï¼ğŸ’ª`;
      
      const response = await fetch('/tools/api/fitness_community/create-post/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
          post_type: 'checkin',
          title: title,
          content: content,
          training_parts: detailData.training_parts,
          difficulty_level: detailData.intensity === 'high' ? 'advanced' : detailData.intensity === 'medium' ? 'intermediate' : 'beginner',
          tags: ['å¥èº«æ‰“å¡', workoutTypeNames[detailData.workout_type]]
        })
      });
      
      const data = await response.json();
      if (data.success) {
        alert('å·²æˆåŠŸåˆ†äº«åˆ°ç¤¾åŒºï¼');
      }
    } catch (error) {
      console.error('åˆ›å»ºç¤¾åŒºå¸–å­å¤±è´¥:', error);
      alert('åˆ†äº«åˆ°ç¤¾åŒºå¤±è´¥ï¼Œä½†æ‰“å¡å·²ä¿å­˜');
    }
  }
  
  async deleteCheckin(dateStr) {
    try {
      const response = await fetch(`/tools/api/checkin/delete/${this.getCheckinId(dateStr)}/`, {
        method: 'DELETE',
        headers: {
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
      });
      
      const result = await response.json();
      
      if (result.success) {
        await this.loadCalendarData();
        this.renderCalendar();
        this.updateStats();
        alert('åˆ é™¤æˆåŠŸ');
      } else {
        alert('åˆ é™¤å¤±è´¥: ' + result.error);
      }
    } catch (error) {
      console.error('åˆ é™¤æ‰“å¡å¤±è´¥:', error);
      alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');
    }
  }
  
  getCheckinId(dateStr) {
    // è¿™é‡Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè·å–checkin_id
    return 1; // ä¸´æ—¶è¿”å›
  }
  
  getWorkoutTypeName(type) {
    const types = {
      'strength': 'åŠ›é‡è®­ç»ƒ',
      'cardio': 'æœ‰æ°§è®­ç»ƒ',
      'yoga': 'ç‘œä¼½',
      'hiit': 'é«˜å¼ºåº¦é—´æ­‡',
      'flexibility': 'æŸ”éŸ§æ€§è®­ç»ƒ',
      'other': 'å…¶ä»–'
    };
    return types[type] || type;
  }
  
  getIntensityName(intensity) {
    const intensities = {
      'low': 'ä½',
      'medium': 'ä¸­',
      'high': 'é«˜'
    };
    return intensities[intensity] || intensity;
  }
  
  updateStats() {
    const completionRateEl = document.getElementById('completionRate');
    const totalDurationEl = document.getElementById('totalDuration');
    const completedDaysEl = document.getElementById('completedDays');
    
    if (completionRateEl) {
      completionRateEl.textContent = `${this.monthlyStats.completion_rate || 0}%`;
    }
    if (totalDurationEl) {
      totalDurationEl.textContent = this.monthlyStats.total_duration || 0;
    }
    if (completedDaysEl) {
      completedDaysEl.textContent = this.monthlyStats.completed_days || 0;
    }
  }
  
  bindEvents() {
    const prevMonthBtn = document.getElementById('prevMonth');
    const nextMonthBtn = document.getElementById('nextMonth');
    const goTodayBtn = document.getElementById('goToday');
    
    if (prevMonthBtn) {
      prevMonthBtn.addEventListener('click', () => {
        this.currentMonth--;
        if (this.currentMonth < 0) {
          this.currentMonth = 11;
          this.currentYear--;
        }
        this.loadCalendarData().then(() => this.renderCalendar());
      });
    }
    
    if (nextMonthBtn) {
      nextMonthBtn.addEventListener('click', () => {
        this.currentMonth++;
        if (this.currentMonth > 11) {
          this.currentMonth = 0;
          this.currentYear++;
        }
        this.loadCalendarData().then(() => this.renderCalendar());
      });
    }
    
    if (goTodayBtn) {
      goTodayBtn.addEventListener('click', () => {
        this.currentDate = new Date();
        this.currentYear = this.currentDate.getFullYear();
        this.currentMonth = this.currentDate.getMonth();
        this.loadCalendarData().then(() => this.renderCalendar());
      });
    }
  }
  
  async loadAchievements() {
    try {
      const response = await fetch('/tools/api/achievements/?type=fitness');
      const data = await response.json();
      
      if (data.success) {
        this.renderAchievements(data.achievements || []);
        this.updateAchievementStats(data.stats || {});
      } else {
        console.error('åŠ è½½æˆå°±å¤±è´¥:', data.error);
        this.showAchievementError();
      }
    } catch (error) {
      console.error('åŠ è½½æˆå°±æ•°æ®å¤±è´¥:', error);
      this.showAchievementError();
    }
  }
  
  renderAchievements(achievements) {
    const container = document.getElementById('achievementsContainer');
    if (!container) return;
    
    // ç¡®ä¿achievementsæ˜¯æ•°ç»„
    if (!Array.isArray(achievements)) {
      achievements = [];
    }
    
    if (achievements.length === 0) {
      container.innerHTML = `
        <div class="loading-message">
          æš‚æ— æˆå°±æ•°æ®ï¼Œå®Œæˆæ‚¨çš„ç¬¬ä¸€æ¬¡æ‰“å¡æ¥è·å¾—æˆå°±å§ï¼
        </div>
      `;
      return;
    }
    
    const achievementHTML = achievements.map(achievement => {
      // ç¡®ä¿achievementå¯¹è±¡å­˜åœ¨ä¸”åŒ…å«å¿…è¦å±æ€§
      if (!achievement) return '';
      
      const statusClass = achievement.is_achieved ? 'unlocked' : 'locked';
      const progressBar = achievement.is_achieved ? '' : `
        <div class="achievement-progress">
          <div class="achievement-progress-bar" style="width: ${achievement.progress || 0}%"></div>
        </div>
      `;
      const meta = achievement.is_achieved ? 
        `<div class="achievement-meta">å·²è·å¾—</div>` : 
        `<div class="achievement-meta">${achievement.current || 0}/${achievement.target || 0}</div>`;
      
      return `
        <div class="achievement ${statusClass}">
          <i class="${achievement.icon || 'fas fa-trophy'}"></i>
          <div class="achievement-info">
            <div class="achievement-title">${achievement.title || 'æœªçŸ¥æˆå°±'}</div>
            <div class="achievement-desc">${achievement.description || 'æš‚æ— æè¿°'}</div>
            ${progressBar}
          </div>
          ${meta}
        </div>
      `;
    }).join('');
    
    container.innerHTML = achievementHTML;
  }
  
  updateAchievementStats(stats) {
    // æ£€æŸ¥statsæ˜¯å¦å­˜åœ¨
    if (!stats) {
      console.warn('æˆå°±ç»Ÿè®¡æ•°æ®ä¸ºç©º');
      return;
    }
    
    const elements = {
      achievementCount: document.getElementById('achievementCount'),
      currentStreakStat: document.getElementById('currentStreakStat'),
      totalCheckinsStat: document.getElementById('totalCheckinsStat')
    };
    
    if (elements.achievementCount) {
      elements.achievementCount.textContent = stats.achievement_count || 0;
    }
    if (elements.currentStreakStat) {
      elements.currentStreakStat.textContent = stats.current_streak || 0;
    }
    if (elements.totalCheckinsStat) {
      elements.totalCheckinsStat.textContent = stats.total_checkins || 0;
    }
  }
  
  showAchievementError() {
    const container = document.getElementById('achievementsContainer');
    if (container) {
      container.innerHTML = `
        <div class="loading-message" style="color: #ff6b6b;">
          åŠ è½½æˆå°±æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•
        </div>
      `;
    }
  }
}

// åˆå§‹åŒ–æ‰“å¡æ—¥å†
document.addEventListener('DOMContentLoaded', function() {
  new CheckInCalendar();
});

// è®­ç»ƒè®¡åˆ’ç¼–è¾‘å™¨ç›¸å…³å‡½æ•°
function openPlanEditor() {
  window.location.href = '/tools/fitness/plan-editor/';
}

function openPlanLibrary() {
  alert('è®¡åˆ’åº“åŠŸèƒ½å³å°†æ¨å‡ºï¼');
}

function openPlanTemplates() {
  alert('æ¨¡æ¿æ¨èåŠŸèƒ½å³å°†æ¨å‡ºï¼');
}

// é¡µé¢åŠ è½½å®Œæˆåçš„å…¶ä»–åˆå§‹åŒ–

// æ·»åŠ åŠ¨ç”»å’Œæ ·å¼
const style = document.createElement('style');
style.textContent = `
  @keyframes slideInRight {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  
  @keyframes slideOutRight {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
  }
  
  /* ç¡®è®¤å¯¹è¯æ¡†æ ·å¼ */
  .confirmation-message {
    text-align: center;
    margin: 20px 0;
    padding: 20px;
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
  }
  
  .confirmation-message p {
    margin: 10px 0;
    color: #856404;
    line-height: 1.5;
  }
  
  .confirmation-message strong {
    color: #ff6b35;
  }
  
  .btn-confirm {
    background: #ff6b35;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
  }
  
  .btn-confirm:hover {
    background: #e55a2b;
    transform: translateY(-2px);
  }
  
  /* é€šçŸ¥æ ·å¼ */
  .notification {
    animation: slideInRight 0.3s ease-out;
  }
  
  .notification.notification-error {
    background-color: #f44336;
  }
  
  .notification.notification-success {
    background-color: #4CAF50;
  }
  
  .notification.notification-info {
    background-color: #2196F3;
  }
`;
document.head.appendChild(style);

// è¿›å…¥ç¤¾åŒºåŠŸèƒ½
function openFitnessCommunity() {
  window.location.href = '/tools/fitness/community/';
}

// ä¸ªäººæ¡£æ¡ˆåŠŸèƒ½
function openFitnessProfile() {
  window.location.href = '/tools/fitness/profile/';
}

// æ›´å¤šå·¥å…·åŠŸèƒ½
function openFitnessTools() {
  window.location.href = '/tools/fitness/tools/';
}
</script>
{% endblock %} 