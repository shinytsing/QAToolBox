<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªåŠ¨æ±‚èŒæœº - æ”¹è¿›ç‰ˆæµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .login-container {
            display: none;
            margin: 20px 0;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .login-iframe {
            width: 100%;
            height: 600px;
            border: none;
            background: #f9f9f9;
        }
        
        .login-controls {
            background: #f8f9fa;
            padding: 15px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn-embedded {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-embedded:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .login-status {
            margin-left: auto;
            font-weight: 600;
            color: #495057;
        }
        
        .status-success {
            color: #28a745;
        }
        
        .status-error {
            color: #dc3545;
        }
        
        .token-info {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            display: none;
        }
        
        .feature-highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .feature-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .login-header {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .login-header h5 {
            margin-bottom: 10px;
            color: #495057;
        }
        
        .login-tips {
            background: #f8f9fa;
            padding: 15px;
            border-top: 1px solid #e0e0e0;
        }
        
        .login-tips .alert {
            margin-bottom: 0;
        }
        
        .login-tips ul {
            padding-left: 20px;
        }
        
        .login-tips li {
            margin-bottom: 5px;
            color: #6c757d;
        }
        
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            max-height: 150px;
            overflow-y: auto;
            display: none;
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .step {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e9ecef;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .step.active .step-number {
            background: #007bff;
            color: white;
        }
        
        .step.completed .step-number {
            background: #28a745;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0">
                            <i class="fas fa-robot"></i> è‡ªåŠ¨æ±‚èŒæœº - æ”¹è¿›ç‰ˆ
                        </h3>
                    </div>
                    <div class="card-body">
                        <!-- åŠŸèƒ½è¯´æ˜ -->
                        <div class="feature-highlight text-center">
                            <div class="feature-icon">
                                <i class="fas fa-window-maximize"></i>
                            </div>
                            <h4>ğŸ¯ æ”¹è¿›çš„åµŒå…¥å¼ç™»å½•</h4>
                            <p class="mb-0">ä¼˜åŒ–äº†iframeç™»å½•ä½“éªŒï¼Œå¢åŠ äº†è¯¦ç»†çš„çŠ¶æ€æç¤ºå’Œé”™è¯¯å¤„ç†</p>
                        </div>
                        
                        <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
                        <div class="step-indicator">
                            <div class="step active" id="step1">
                                <div class="step-number">1</div>
                                <span>å¼€å§‹ç™»å½•</span>
                            </div>
                            <div class="step" id="step2">
                                <div class="step-number">2</div>
                                <span>å®Œæˆç™»å½•</span>
                            </div>
                            <div class="step" id="step3">
                                <div class="step-number">3</div>
                                <span>è·å–Token</span>
                            </div>
                            <div class="step" id="step4">
                                <div class="step-number">4</div>
                                <span>å¼€å§‹æ±‚èŒ</span>
                            </div>
                        </div>
                        
                        <!-- Bossç›´è˜ç™»å½•çŠ¶æ€ -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">
                                            <i class="fab fa-boss"></i> Bossç›´è˜ç™»å½•çŠ¶æ€
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="bossLoginStatus">
                                            <p class="text-muted">æœªç™»å½•</p>
                                            <button id="checkLoginBtn" class="btn btn-primary btn-sm">
                                                <i class="fas fa-sync-alt"></i> æ£€æŸ¥ç™»å½•çŠ¶æ€
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">
                                            <i class="fas fa-key"></i> TokençŠ¶æ€
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="tokenStatus">
                                            <p class="text-muted">æœªè·å–</p>
                                            <button id="getTokenBtn" class="btn btn-success btn-sm" disabled>
                                                <i class="fas fa-download"></i> è·å–Token
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ç™»å½•æ–¹å¼é€‰æ‹© -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">
                                            <i class="fas fa-sign-in-alt"></i> Bossç›´è˜ç™»å½•
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="text-center p-4">
                                            <div class="mb-3">
                                                <i class="fas fa-window-maximize fa-3x text-primary"></i>
                                            </div>
                                            <h5>ğŸ“± åµŒå…¥å¼ç™»å½•ï¼ˆæ”¹è¿›ç‰ˆï¼‰</h5>
                                            <p class="text-muted">åœ¨é¡µé¢ä¸­ç›´æ¥ç™»å½•Bossç›´è˜ï¼Œæ”¯æŒè¯¦ç»†çŠ¶æ€æç¤ºå’Œè‡ªåŠ¨é‡è¯•</p>
                                            <button id="embeddedLoginBtn" class="btn btn-primary btn-lg">
                                                <i class="fas fa-window-maximize"></i> å¼€å§‹ç™»å½•
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- åµŒå…¥å¼ç™»å½•å®¹å™¨ -->
                        <div id="embeddedLoginContainer" class="login-container">
                            <div class="login-header">
                                <h5><i class="fas fa-info-circle"></i> ç™»å½•è¯´æ˜</h5>
                                <p class="text-muted">è¯·åœ¨ä¸‹æ–¹iframeä¸­å®ŒæˆBossç›´è˜ç™»å½•ï¼Œç™»å½•å®Œæˆåç‚¹å‡»"æ£€æŸ¥ç™»å½•çŠ¶æ€"æŒ‰é’®</p>
                            </div>
                            <iframe id="bossLoginFrame" class="login-iframe" src="about:blank"></iframe>
                            <div class="login-controls">
                                <button class="btn-embedded" onclick="checkLoginStatus()">
                                    <i class="fas fa-sync-alt"></i> æ£€æŸ¥ç™»å½•çŠ¶æ€
                                </button>
                                <button class="btn-embedded" onclick="getUserToken()">
                                    <i class="fas fa-key"></i> è·å–Token
                                </button>
                                <button class="btn-secondary" onclick="hideEmbeddedLogin()">
                                    <i class="fas fa-times"></i> å…³é—­
                                </button>
                                <span id="loginStatusText" class="login-status">å‡†å¤‡ç™»å½•...</span>
                            </div>
                            <div class="login-tips">
                                <div class="alert alert-info">
                                    <h6><i class="fas fa-lightbulb"></i> ç™»å½•æç¤ºï¼š</h6>
                                    <ul class="mb-0">
                                        <li>å¦‚æœiframeæ— æ³•æ­£å¸¸æ˜¾ç¤ºï¼Œè¯·å°è¯•åˆ·æ–°é¡µé¢</li>
                                        <li>ç™»å½•å®Œæˆåï¼Œè¯·ç­‰å¾…å‡ ç§’é’Ÿå†ç‚¹å‡»"æ£€æŸ¥ç™»å½•çŠ¶æ€"</li>
                                        <li>å¦‚æœç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒéªŒè¯ç </li>
                                        <li>å»ºè®®ä½¿ç”¨æ‰‹æœºå·+éªŒè¯ç æ–¹å¼ç™»å½•ï¼Œæ›´ç¨³å®š</li>
                                        <li>ç³»ç»Ÿä¼šè‡ªåŠ¨é‡è¯•ç™»å½•çŠ¶æ€æ£€æŸ¥</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Tokenä¿¡æ¯æ˜¾ç¤º -->
                        <div id="tokenInfo" class="token-info"></div>
                        
                        <!-- è°ƒè¯•ä¿¡æ¯ -->
                        <div id="debugInfo" class="debug-info"></div>

                        <!-- æ±‚èŒé…ç½®è¡¨å• -->
                        <div id="jobConfigForm" style="display: none;">
                            <hr>
                            <h4><i class="fas fa-cog"></i> æ±‚èŒé…ç½®</h4>
                            <form id="jobSearchForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="jobTitle">æœŸæœ›èŒä½</label>
                                            <input type="text" class="form-control" id="jobTitle" name="jobTitle" placeholder="å¦‚ï¼šPythonå¼€å‘å·¥ç¨‹å¸ˆ" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="location">å·¥ä½œåœ°ç‚¹</label>
                                            <input type="text" class="form-control" id="location" name="location" placeholder="å¦‚ï¼šåŒ—äº¬" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="minSalary">æœ€ä½è–ªèµ„ï¼ˆKï¼‰</label>
                                            <input type="number" class="form-control" id="minSalary" name="minSalary" min="1" max="100" value="10" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="maxSalary">æœ€é«˜è–ªèµ„ï¼ˆKï¼‰</label>
                                            <input type="number" class="form-control" id="maxSalary" name="maxSalary" min="1" max="200" value="30" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="experienceLevel">å·¥ä½œç»éªŒ</label>
                                            <select class="form-control" id="experienceLevel" name="experienceLevel" required>
                                                <option value="fresh">åº”å±Šç”Ÿ</option>
                                                <option value="1-3" selected>1-3å¹´</option>
                                                <option value="3-5">3-5å¹´</option>
                                                <option value="5-10">5-10å¹´</option>
                                                <option value="10+">10å¹´ä»¥ä¸Š</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="maxApplications">æœ€å¤§æŠ•é€’æ•°é‡</label>
                                            <input type="number" class="form-control" id="maxApplications" name="maxApplications" min="1" max="100" value="20" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="keywords">å…³é”®è¯ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
                                    <input type="text" class="form-control" id="keywords" name="keywords" placeholder="å¦‚ï¼šPython,Django,Flask">
                                </div>
                                <button type="submit" class="btn btn-success btn-lg">
                                    <i class="fas fa-rocket"></i> å¼€å§‹è‡ªåŠ¨æ±‚èŒ
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let loginCheckInterval = null;
        let retryCount = 0;
        const maxRetries = 3;

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.querySelector('.card-body').insertBefore(alertDiv, document.querySelector('.card-body').firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
        function updateStep(stepNumber, status = 'active') {
            const steps = document.querySelectorAll('.step');
            steps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index + 1 < stepNumber) {
                    step.classList.add('completed');
                } else if (index + 1 === stepNumber) {
                    step.classList.add(status);
                }
            });
        }

        // æ·»åŠ è°ƒè¯•ä¿¡æ¯
        function addDebugInfo(message) {
            const debugInfo = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `[${timestamp}] ${message}\n`;
            debugInfo.style.display = 'block';
            debugInfo.scrollTop = debugInfo.scrollHeight;
        }

        // åµŒå…¥å¼ç™»å½•åŠŸèƒ½
        function showEmbeddedLogin() {
            document.getElementById('embeddedLoginContainer').style.display = 'block';
            updateStep(1, 'active');
            addDebugInfo('å¼€å§‹åµŒå…¥å¼ç™»å½•æµç¨‹');
            loadLoginPage();
        }

        function hideEmbeddedLogin() {
            document.getElementById('embeddedLoginContainer').style.display = 'none';
            addDebugInfo('å…³é—­ç™»å½•å®¹å™¨');
        }

        async function loadLoginPage() {
            try {
                document.getElementById('loginStatusText').textContent = 'æ­£åœ¨åŠ è½½ç™»å½•é¡µé¢...';
                addDebugInfo('æ­£åœ¨åŠ è½½Bossç›´è˜ç™»å½•é¡µé¢...');
                
                // æ¨¡æ‹ŸAPIè°ƒç”¨
                setTimeout(() => {
                    document.getElementById('bossLoginFrame').src = 'https://www.zhipin.com/';
                    document.getElementById('loginStatusText').textContent = 'ç™»å½•é¡µé¢å·²åŠ è½½ï¼Œè¯·åœ¨iframeä¸­å®Œæˆç™»å½•';
                    showAlert('ç™»å½•é¡µé¢åŠ è½½æˆåŠŸï¼è¯·åœ¨iframeä¸­å®Œæˆç™»å½•', 'success');
                    addDebugInfo('Bossç›´è˜ç™»å½•é¡µé¢åŠ è½½å®Œæˆ');
                    
                    // ç›‘å¬iframeåŠ è½½å®Œæˆäº‹ä»¶
                    const iframe = document.getElementById('bossLoginFrame');
                    iframe.onload = function() {
                        addDebugInfo('iframeé¡µé¢åŠ è½½å®Œæˆ');
                        document.getElementById('loginStatusText').textContent = 'é¡µé¢å·²åŠ è½½ï¼Œè¯·å¼€å§‹ç™»å½•';
                    };
                    
                    // ç›‘å¬iframeé”™è¯¯äº‹ä»¶
                    iframe.onerror = function() {
                        addDebugInfo('iframeé¡µé¢åŠ è½½å¤±è´¥');
                        document.getElementById('loginStatusText').textContent = 'é¡µé¢åŠ è½½å¤±è´¥';
                        showAlert('ç™»å½•é¡µé¢åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•', 'error');
                    };
                    
                }, 1000);
                
            } catch (error) {
                console.error('åŠ è½½ç™»å½•é¡µé¢å¤±è´¥:', error);
                document.getElementById('loginStatusText').textContent = 'åŠ è½½å¤±è´¥';
                showAlert('åŠ è½½ç™»å½•é¡µé¢å¤±è´¥: ' + error.message, 'error');
                addDebugInfo('ç™»å½•é¡µé¢åŠ è½½å¤±è´¥: ' + error.message);
            }
        }

        async function checkLoginStatus() {
            try {
                const statusText = document.getElementById('loginStatusText');
                statusText.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æ­£åœ¨æ£€æŸ¥ç™»å½•çŠ¶æ€...';
                addDebugInfo('å¼€å§‹æ£€æŸ¥ç™»å½•çŠ¶æ€...');
                
                // æ¨¡æ‹ŸAPIè°ƒç”¨
                setTimeout(() => {
                    const isLoggedIn = Math.random() > 0.5; // éšæœºæ¨¡æ‹Ÿç™»å½•çŠ¶æ€
                    
                    if (isLoggedIn) {
                        statusText.innerHTML = '<i class="fas fa-check-circle"></i> å·²ç™»å½•';
                        statusText.className = 'login-status status-success';
                        updateBossLoginStatus(true, {username: 'æµ‹è¯•ç”¨æˆ·'});
                        updateStep(2, 'completed');
                        updateStep(3, 'active');
                        showAlert('ç™»å½•æˆåŠŸï¼', 'success');
                        addDebugInfo('ç™»å½•çŠ¶æ€æ£€æŸ¥æˆåŠŸï¼šå·²ç™»å½•');
                        
                        // è‡ªåŠ¨éšè—ç™»å½•å®¹å™¨
                        setTimeout(() => {
                            hideEmbeddedLogin();
                        }, 2000);
                        
                    } else {
                        statusText.innerHTML = '<i class="fas fa-times-circle"></i> æœªç™»å½•';
                        statusText.className = 'login-status status-error';
                        showAlert('ç”¨æˆ·å°šæœªç™»å½•ï¼Œè¯·åœ¨iframeä¸­å®Œæˆç™»å½•', 'info');
                        addDebugInfo('ç™»å½•çŠ¶æ€æ£€æŸ¥ç»“æœï¼šæœªç™»å½•');
                        
                        // è§¦å‘é‡è¯•æœºåˆ¶
                        if (retryCount < maxRetries) {
                            retryCount++;
                            addDebugInfo(`ç™»å½•æ£€æŸ¥å¤±è´¥ï¼Œç¬¬${retryCount}æ¬¡é‡è¯•å°†åœ¨${2 * retryCount}ç§’åè¿›è¡Œ...`);
                            setTimeout(() => {
                                checkLoginStatus();
                            }, 2000 * retryCount);
                        } else {
                            addDebugInfo('å·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œè¯·æ‰‹åŠ¨é‡è¯•');
                        }
                    }
                }, 1000);
                
            } catch (error) {
                console.error('æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥:', error);
                const statusText = document.getElementById('loginStatusText');
                statusText.innerHTML = '<i class="fas fa-exclamation-triangle"></i> æ£€æŸ¥å¤±è´¥';
                statusText.className = 'login-status status-error';
                
                let errorMessage = 'æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥: ' + error.message;
                if (error.message.includes('fetch')) {
                    errorMessage = 'ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';
                }
                
                showAlert(errorMessage, 'error');
                addDebugInfo('ç™»å½•çŠ¶æ€æ£€æŸ¥å¤±è´¥: ' + error.message);
            }
        }

        async function getUserToken() {
            try {
                document.getElementById('loginStatusText').textContent = 'æ­£åœ¨è·å–Token...';
                addDebugInfo('å¼€å§‹è·å–ç”¨æˆ·Token...');
                
                // æ¨¡æ‹ŸAPIè°ƒç”¨
                setTimeout(() => {
                    document.getElementById('loginStatusText').textContent = 'Tokenå·²è·å–';
                    document.getElementById('loginStatusText').className = 'login-status status-success';
                    
                    // æ˜¾ç¤ºæ¨¡æ‹Ÿtokenä¿¡æ¯
                    const tokenInfo = document.getElementById('tokenInfo');
                    const mockTokenData = {
                        success: true,
                        is_logged_in: true,
                        token: "mock_token_123456789",
                        user_info: {
                            username: "æµ‹è¯•ç”¨æˆ·",
                            user_id: "12345"
                        }
                    };
                    tokenInfo.textContent = JSON.stringify(mockTokenData, null, 2);
                    tokenInfo.style.display = 'block';
                    
                    updateTokenStatus(true);
                    updateStep(3, 'completed');
                    updateStep(4, 'active');
                    showAlert('Tokenè·å–æˆåŠŸï¼å¯ç”¨äºåç»­æ±‚èŒè¯·æ±‚', 'success');
                    addDebugInfo('Tokenè·å–æˆåŠŸ');
                }, 1000);
                
            } catch (error) {
                console.error('è·å–Tokenå¤±è´¥:', error);
                document.getElementById('loginStatusText').textContent = 'è·å–å¤±è´¥';
                showAlert('è·å–Tokenå¤±è´¥: ' + error.message, 'error');
                addDebugInfo('Tokenè·å–å¤±è´¥: ' + error.message);
            }
        }

        // æ›´æ–°Bossç™»å½•çŠ¶æ€
        function updateBossLoginStatus(isLoggedIn, userInfo = {}) {
            const statusDiv = document.getElementById('bossLoginStatus');
            if (isLoggedIn) {
                statusDiv.innerHTML = `
                    <p class="text-success"><i class="fas fa-check-circle"></i> å·²ç™»å½•</p>
                    <p class="text-muted small">ç”¨æˆ·: ${userInfo.username || 'æœªçŸ¥ç”¨æˆ·'}</p>
                    <button class="btn btn-success btn-sm" onclick="getUserToken()">
                        <i class="fas fa-key"></i> è·å–Token
                    </button>
                `;
                document.getElementById('getTokenBtn').disabled = false;
                document.getElementById('jobConfigForm').style.display = 'block';
            } else {
                statusDiv.innerHTML = `
                    <p class="text-muted">æœªç™»å½•</p>
                    <button class="btn btn-primary btn-sm" onclick="checkLoginStatus()">
                        <i class="fas fa-sync-alt"></i> æ£€æŸ¥ç™»å½•çŠ¶æ€
                    </button>
                `;
                document.getElementById('getTokenBtn').disabled = true;
                document.getElementById('jobConfigForm').style.display = 'none';
            }
        }

        // æ›´æ–°TokençŠ¶æ€
        function updateTokenStatus(hasToken) {
            const statusDiv = document.getElementById('tokenStatus');
            if (hasToken) {
                statusDiv.innerHTML = `
                    <p class="text-success"><i class="fas fa-check-circle"></i> Tokenå·²è·å–</p>
                    <button class="btn btn-info btn-sm" onclick="showTokenInfo()">
                        <i class="fas fa-eye"></i> æŸ¥çœ‹Token
                    </button>
                `;
            } else {
                statusDiv.innerHTML = `
                    <p class="text-muted">æœªè·å–</p>
                    <button class="btn btn-success btn-sm" onclick="getUserToken()" disabled>
                        <i class="fas fa-download"></i> è·å–Token
                    </button>
                `;
            }
        }

        // æ˜¾ç¤ºTokenä¿¡æ¯
        function showTokenInfo() {
            const tokenInfo = document.getElementById('tokenInfo');
            if (tokenInfo.style.display === 'none') {
                tokenInfo.style.display = 'block';
            } else {
                tokenInfo.style.display = 'none';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            document.getElementById('embeddedLoginBtn').addEventListener('click', showEmbeddedLogin);
            document.getElementById('checkLoginBtn').addEventListener('click', checkLoginStatus);
            document.getElementById('getTokenBtn').addEventListener('click', getUserToken);
            
            // æ£€æŸ¥åˆå§‹ç™»å½•çŠ¶æ€
            checkLoginStatus();
            
            addDebugInfo('è‡ªåŠ¨æ±‚èŒæœºæ”¹è¿›ç‰ˆå·²åŠ è½½');
            addDebugInfo('æ”¯æŒè¯¦ç»†çš„ç™»å½•çŠ¶æ€æç¤ºå’Œè‡ªåŠ¨é‡è¯•æœºåˆ¶');
            
            console.log('âœ… è‡ªåŠ¨æ±‚èŒæœºæ”¹è¿›ç‰ˆå·²åŠ è½½');
            console.log('âœ… æ”¯æŒè¯¦ç»†çš„ç™»å½•çŠ¶æ€æç¤ºå’Œè‡ªåŠ¨é‡è¯•æœºåˆ¶');
        });
    </script>
</body>
</html>
