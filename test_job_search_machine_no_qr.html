<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自动求职机 - 无二维码登录测试</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .login-container {
            display: none;
            margin: 20px 0;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .login-iframe {
            width: 100%;
            height: 600px;
            border: none;
            background: #f9f9f9;
        }
        
        .login-controls {
            background: #f8f9fa;
            padding: 15px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .btn-embedded {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-embedded:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .login-status {
            margin-left: auto;
            font-weight: 600;
            color: #495057;
        }
        
        .status-success {
            color: #28a745;
        }
        
        .status-error {
            color: #dc3545;
        }
        
        .token-info {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            display: none;
        }
        
        .feature-highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .feature-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0">
                            <i class="fas fa-robot"></i> 自动求职机 - 简化版
                        </h3>
                    </div>
                    <div class="card-body">
                        <!-- 功能说明 -->
                        <div class="feature-highlight text-center">
                            <div class="feature-icon">
                                <i class="fas fa-window-maximize"></i>
                            </div>
                            <h4>🎯 专注嵌入式登录</h4>
                            <p class="mb-0">已移除二维码登录方式，专注于更安全可靠的嵌入式登录体验</p>
                        </div>
                        
                        <!-- Boss直聘登录状态 -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">
                                            <i class="fab fa-boss"></i> Boss直聘登录状态
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="bossLoginStatus">
                                            <p class="text-muted">未登录</p>
                                            <button id="checkLoginBtn" class="btn btn-primary btn-sm">
                                                <i class="fas fa-sync-alt"></i> 检查登录状态
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">
                                            <i class="fas fa-key"></i> Token状态
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="tokenStatus">
                                            <p class="text-muted">未获取</p>
                                            <button id="getTokenBtn" class="btn btn-success btn-sm" disabled>
                                                <i class="fas fa-download"></i> 获取Token
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 登录方式选择 -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">
                                            <i class="fas fa-sign-in-alt"></i> Boss直聘登录
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="text-center p-4">
                                            <div class="mb-3">
                                                <i class="fas fa-window-maximize fa-3x text-primary"></i>
                                            </div>
                                            <h5>📱 嵌入式登录</h5>
                                            <p class="text-muted">在页面中直接登录Boss直聘，更安全可靠</p>
                                            <button id="embeddedLoginBtn" class="btn btn-primary btn-lg">
                                                <i class="fas fa-window-maximize"></i> 开始登录
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 嵌入式登录容器 -->
                        <div id="embeddedLoginContainer" class="login-container">
                            <iframe id="bossLoginFrame" class="login-iframe" src="about:blank"></iframe>
                            <div class="login-controls">
                                <button class="btn-embedded" onclick="checkLoginStatus()">
                                    <i class="fas fa-sync-alt"></i> 检查登录状态
                                </button>
                                <button class="btn-embedded" onclick="getUserToken()">
                                    <i class="fas fa-key"></i> 获取Token
                                </button>
                                <button class="btn-secondary" onclick="hideEmbeddedLogin()">
                                    <i class="fas fa-times"></i> 关闭
                                </button>
                                <span id="loginStatusText" class="login-status">准备登录...</span>
                            </div>
                        </div>

                        <!-- Token信息显示 -->
                        <div id="tokenInfo" class="token-info"></div>

                        <!-- 求职配置表单 -->
                        <div id="jobConfigForm" style="display: none;">
                            <hr>
                            <h4><i class="fas fa-cog"></i> 求职配置</h4>
                            <form id="jobSearchForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="jobTitle">期望职位</label>
                                            <input type="text" class="form-control" id="jobTitle" name="jobTitle" placeholder="如：Python开发工程师" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="location">工作地点</label>
                                            <input type="text" class="form-control" id="location" name="location" placeholder="如：北京" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="minSalary">最低薪资（K）</label>
                                            <input type="number" class="form-control" id="minSalary" name="minSalary" min="1" max="100" value="10" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="maxSalary">最高薪资（K）</label>
                                            <input type="number" class="form-control" id="maxSalary" name="maxSalary" min="1" max="200" value="30" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="experienceLevel">工作经验</label>
                                            <select class="form-control" id="experienceLevel" name="experienceLevel" required>
                                                <option value="fresh">应届生</option>
                                                <option value="1-3" selected>1-3年</option>
                                                <option value="3-5">3-5年</option>
                                                <option value="5-10">5-10年</option>
                                                <option value="10+">10年以上</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="maxApplications">最大投递数量</label>
                                            <input type="number" class="form-control" id="maxApplications" name="maxApplications" min="1" max="100" value="20" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="keywords">关键词（用逗号分隔）</label>
                                    <input type="text" class="form-control" id="keywords" name="keywords" placeholder="如：Python,Django,Flask">
                                </div>
                                <button type="submit" class="btn btn-success btn-lg">
                                    <i class="fas fa-rocket"></i> 开始自动求职
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let loginCheckInterval = null;

        // 显示提示信息
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.querySelector('.card-body').insertBefore(alertDiv, document.querySelector('.card-body').firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // 嵌入式登录功能
        function showEmbeddedLogin() {
            document.getElementById('embeddedLoginContainer').style.display = 'block';
            loadLoginPage();
        }

        function hideEmbeddedLogin() {
            document.getElementById('embeddedLoginContainer').style.display = 'none';
        }

        async function loadLoginPage() {
            try {
                document.getElementById('loginStatusText').textContent = '正在加载登录页面...';
                
                // 模拟API调用
                setTimeout(() => {
                    document.getElementById('bossLoginFrame').src = 'https://www.zhipin.com/';
                    document.getElementById('loginStatusText').textContent = '登录页面已加载，请在iframe中完成登录';
                    showAlert('登录页面加载成功！请在iframe中完成登录', 'success');
                }, 1000);
                
            } catch (error) {
                console.error('加载登录页面失败:', error);
                document.getElementById('loginStatusText').textContent = '加载失败';
                showAlert('加载登录页面失败: ' + error.message, 'error');
            }
        }

        async function checkLoginStatus() {
            try {
                document.getElementById('loginStatusText').textContent = '正在检查登录状态...';
                
                // 模拟API调用
                setTimeout(() => {
                    const isLoggedIn = Math.random() > 0.5; // 随机模拟登录状态
                    
                    if (isLoggedIn) {
                        document.getElementById('loginStatusText').textContent = '已登录';
                        document.getElementById('loginStatusText').className = 'login-status status-success';
                        updateBossLoginStatus(true, {username: '测试用户'});
                        showAlert('登录成功！', 'success');
                    } else {
                        document.getElementById('loginStatusText').textContent = '未登录';
                        document.getElementById('loginStatusText').className = 'login-status status-error';
                        showAlert('用户尚未登录，请在iframe中完成登录', 'info');
                    }
                }, 1000);
                
            } catch (error) {
                console.error('检查登录状态失败:', error);
                document.getElementById('loginStatusText').textContent = '检查失败';
                showAlert('检查登录状态失败: ' + error.message, 'error');
            }
        }

        async function getUserToken() {
            try {
                document.getElementById('loginStatusText').textContent = '正在获取Token...';
                
                // 模拟API调用
                setTimeout(() => {
                    document.getElementById('loginStatusText').textContent = 'Token已获取';
                    document.getElementById('loginStatusText').className = 'login-status status-success';
                    
                    // 显示模拟token信息
                    const tokenInfo = document.getElementById('tokenInfo');
                    const mockTokenData = {
                        success: true,
                        is_logged_in: true,
                        token: "mock_token_123456789",
                        user_info: {
                            username: "测试用户",
                            user_id: "12345"
                        }
                    };
                    tokenInfo.textContent = JSON.stringify(mockTokenData, null, 2);
                    tokenInfo.style.display = 'block';
                    
                    updateTokenStatus(true);
                    showAlert('Token获取成功！可用于后续求职请求', 'success');
                }, 1000);
                
            } catch (error) {
                console.error('获取Token失败:', error);
                document.getElementById('loginStatusText').textContent = '获取失败';
                showAlert('获取Token失败: ' + error.message, 'error');
            }
        }

        // 更新Boss登录状态
        function updateBossLoginStatus(isLoggedIn, userInfo = {}) {
            const statusDiv = document.getElementById('bossLoginStatus');
            if (isLoggedIn) {
                statusDiv.innerHTML = `
                    <p class="text-success"><i class="fas fa-check-circle"></i> 已登录</p>
                    <p class="text-muted small">用户: ${userInfo.username || '未知用户'}</p>
                    <button class="btn btn-success btn-sm" onclick="getUserToken()">
                        <i class="fas fa-key"></i> 获取Token
                    </button>
                `;
                document.getElementById('getTokenBtn').disabled = false;
                document.getElementById('jobConfigForm').style.display = 'block';
            } else {
                statusDiv.innerHTML = `
                    <p class="text-muted">未登录</p>
                    <button class="btn btn-primary btn-sm" onclick="checkLoginStatus()">
                        <i class="fas fa-sync-alt"></i> 检查登录状态
                    </button>
                `;
                document.getElementById('getTokenBtn').disabled = true;
                document.getElementById('jobConfigForm').style.display = 'none';
            }
        }

        // 更新Token状态
        function updateTokenStatus(hasToken) {
            const statusDiv = document.getElementById('tokenStatus');
            if (hasToken) {
                statusDiv.innerHTML = `
                    <p class="text-success"><i class="fas fa-check-circle"></i> Token已获取</p>
                    <button class="btn btn-info btn-sm" onclick="showTokenInfo()">
                        <i class="fas fa-eye"></i> 查看Token
                    </button>
                `;
            } else {
                statusDiv.innerHTML = `
                    <p class="text-muted">未获取</p>
                    <button class="btn btn-success btn-sm" onclick="getUserToken()" disabled>
                        <i class="fas fa-download"></i> 获取Token
                    </button>
                `;
            }
        }

        // 显示Token信息
        function showTokenInfo() {
            const tokenInfo = document.getElementById('tokenInfo');
            if (tokenInfo.style.display === 'none') {
                tokenInfo.style.display = 'block';
            } else {
                tokenInfo.style.display = 'none';
            }
        }

        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 绑定按钮事件
            document.getElementById('embeddedLoginBtn').addEventListener('click', showEmbeddedLogin);
            document.getElementById('checkLoginBtn').addEventListener('click', checkLoginStatus);
            document.getElementById('getTokenBtn').addEventListener('click', getUserToken);
            
            // 检查初始登录状态
            checkLoginStatus();
            
            console.log('✅ 自动求职机已加载 - 二维码登录功能已移除');
            console.log('✅ 只保留嵌入式登录方式');
        });
    </script>
</body>
</html>
