<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多人心动链接测试</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #667eea 100%);
            color: #ffffff;
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .title {
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 2rem;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }
        
        .subtitle {
            text-align: center;
            margin-bottom: 3rem;
            opacity: 0.8;
        }
        
        .test-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .btn {
            background: linear-gradient(135deg, #ff6b9d, #c44569);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn.success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .btn.warning {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
        }
        
        .btn.danger {
            background: linear-gradient(135deg, #dc3545, #e83e8c);
        }
        
        .user-simulator {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .user-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 1.5rem;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .user-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .user-card.matched {
            border-color: #28a745;
            background: rgba(40, 167, 69, 0.2);
        }
        
        .user-card.waiting {
            border-color: #ffc107;
            background: rgba(255, 193, 7, 0.2);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .user-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 1rem;
        }
        
        .user-info h3 {
            margin: 0;
            font-size: 1.2rem;
        }
        
        .user-info p {
            margin: 0;
            opacity: 0.8;
            font-size: 0.9rem;
        }
        
        .user-status {
            margin: 1rem 0;
            padding: 0.5rem;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
        }
        
        .status-pending {
            background: rgba(255, 193, 7, 0.3);
            color: #ffc107;
        }
        
        .status-matched {
            background: rgba(40, 167, 69, 0.3);
            color: #28a745;
        }
        
        .status-cancelled {
            background: rgba(220, 53, 69, 0.3);
            color: #dc3545;
        }
        
        .user-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .user-actions .btn {
            flex: 1;
            padding: 8px 12px;
            font-size: 0.9rem;
        }
        
        .stats-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .stat-item {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .log-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .log-title {
            margin-bottom: 1rem;
            font-weight: bold;
        }
        
        .log-entry {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .log-info {
            background: rgba(0, 123, 255, 0.2);
            border-left: 3px solid #007bff;
        }
        
        .log-success {
            background: rgba(40, 167, 69, 0.2);
            border-left: 3px solid #28a745;
        }
        
        .log-warning {
            background: rgba(255, 193, 7, 0.2);
            border-left: 3px solid #ffc107;
        }
        
        .log-error {
            background: rgba(220, 53, 69, 0.2);
            border-left: 3px solid #dc3545;
        }
        
        .matching-animation {
            text-align: center;
            margin: 2rem 0;
            font-size: 3rem;
            animation: heartbeat 1.5s infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .chat-preview {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
        }
        
        .chat-messages {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }
        
        .message {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            max-width: 80%;
        }
        
        .message.sent {
            background: rgba(255, 107, 157, 0.3);
            margin-left: auto;
        }
        
        .message.received {
            background: rgba(102, 126, 234, 0.3);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="title">💕 多人心动链接测试</h1>
        <p class="subtitle">模拟多用户同时使用心动链接功能</p>
        
        <div class="test-panel">
            <h2>🎮 测试控制</h2>
            <div class="controls">
                <button class="btn" onclick="createUsers()">创建测试用户</button>
                <button class="btn success" onclick="startAllHeartLinks()">全部开始心动链接</button>
                <button class="btn warning" onclick="simulateRandomMatching()">随机匹配</button>
                <button class="btn danger" onclick="cancelAllRequests()">取消所有请求</button>
                <button class="btn" onclick="clearLog()">清空日志</button>
            </div>
        </div>
        
        <div class="stats-panel">
            <h2>📊 实时统计</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number" id="total-users">0</div>
                    <div class="stat-label">总用户数</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="waiting-users">0</div>
                    <div class="stat-label">等待匹配</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="matched-pairs">0</div>
                    <div class="stat-label">已匹配对数</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="active-chats">0</div>
                    <div class="stat-label">活跃聊天</div>
                </div>
            </div>
        </div>
        
        <div class="matching-animation" id="matching-animation" style="display: none;">
            💕
        </div>
        
        <div class="user-simulator" id="user-simulator">
            <!-- 用户卡片将在这里动态生成 -->
        </div>
        
        <div class="log-panel">
            <div class="log-title">📝 操作日志</div>
            <div id="log-container">
                <!-- 日志条目将在这里动态生成 -->
            </div>
        </div>
    </div>
    
    <script>
        // 模拟用户数据
        let users = [];
        let matchedPairs = [];
        let activeChats = [];
        let logEntries = [];
        
        // 用户名字库
        const userNames = [
            'Alice', 'Bob', 'Charlie', 'Diana', 'Eve', 'Frank', 'Grace', 'Henry',
            'Iris', 'Jack', 'Kate', 'Leo', 'Mia', 'Noah', 'Olivia', 'Paul',
            'Quinn', 'Ruby', 'Sam', 'Tina', 'Uma', 'Victor', 'Wendy', 'Xander'
        ];
        
        // 用户头像库
        const userAvatars = ['👤', '👩', '👨', '👧', '👦', '👵', '👴', '👶'];
        
        function createUsers() {
            const count = Math.floor(Math.random() * 8) + 4; // 4-12个用户
            users = [];
            
            for (let i = 0; i < count; i++) {
                const user = {
                    id: i + 1,
                    name: userNames[Math.floor(Math.random() * userNames.length)],
                    avatar: userAvatars[Math.floor(Math.random() * userAvatars.length)],
                    status: 'idle', // idle, waiting, matched, cancelled
                    requestId: null,
                    matchedWith: null,
                    chatRoom: null,
                    messages: []
                };
                users.push(user);
            }
            
            updateUserDisplay();
            updateStats();
            addLog('info', `创建了 ${count} 个测试用户`);
        }
        
        function startAllHeartLinks() {
            if (users.length === 0) {
                addLog('warning', '请先创建测试用户');
                return;
            }
            
            users.forEach(user => {
                if (user.status === 'idle') {
                    user.status = 'waiting';
                    user.requestId = Date.now() + Math.random();
                    addLog('info', `${user.name} 开始心动链接`);
                }
            });
            
            updateUserDisplay();
            updateStats();
            showMatchingAnimation();
            
            // 模拟匹配过程
            setTimeout(() => {
                simulateMatching();
            }, 2000);
        }
        
        function simulateMatching() {
            const waitingUsers = users.filter(u => u.status === 'waiting');
            
            while (waitingUsers.length >= 2) {
                const user1 = waitingUsers.splice(Math.floor(Math.random() * waitingUsers.length), 1)[0];
                const user2 = waitingUsers.splice(Math.floor(Math.random() * waitingUsers.length), 1)[0];
                
                // 创建匹配
                const roomId = 'room_' + Date.now() + Math.random();
                user1.status = 'matched';
                user1.matchedWith = user2.name;
                user1.chatRoom = roomId;
                
                user2.status = 'matched';
                user2.matchedWith = user1.name;
                user2.chatRoom = roomId;
                
                matchedPairs.push({
                    user1: user1.name,
                    user2: user2.name,
                    roomId: roomId,
                    startTime: new Date()
                });
                
                activeChats.push(roomId);
                
                addLog('success', `🎉 ${user1.name} 与 ${user2.name} 匹配成功！`);
                
                // 模拟聊天消息
                setTimeout(() => {
                    simulateChatMessages(user1, user2);
                }, 1000);
            }
            
            updateUserDisplay();
            updateStats();
            hideMatchingAnimation();
        }
        
        function simulateRandomMatching() {
            if (users.length === 0) {
                addLog('warning', '请先创建测试用户');
                return;
            }
            
            // 随机选择一些用户开始心动链接
            const randomUsers = users.filter(() => Math.random() > 0.5);
            
            randomUsers.forEach(user => {
                if (user.status === 'idle') {
                    user.status = 'waiting';
                    user.requestId = Date.now() + Math.random();
                    addLog('info', `${user.name} 随机开始心动链接`);
                }
            });
            
            updateUserDisplay();
            updateStats();
            showMatchingAnimation();
            
            setTimeout(() => {
                simulateMatching();
            }, 1500);
        }
        
        function cancelAllRequests() {
            users.forEach(user => {
                if (user.status === 'waiting') {
                    user.status = 'cancelled';
                    addLog('warning', `${user.name} 取消了心动链接请求`);
                }
            });
            
            updateUserDisplay();
            updateStats();
            hideMatchingAnimation();
        }
        
        function simulateChatMessages(user1, user2) {
            const messages = [
                '你好！很高兴认识你 😊',
                '我也是！今天天气不错呢',
                '你喜欢什么类型的音乐？',
                '我喜欢轻音乐和民谣',
                '那我们很有共同话题呢！',
                '是的！要不要聊聊其他话题？',
                '当然可以，你想聊什么？',
                '比如旅行、美食或者电影？'
            ];
            
            let messageIndex = 0;
            const interval = setInterval(() => {
                if (messageIndex >= messages.length) {
                    clearInterval(interval);
                    return;
                }
                
                const message = messages[messageIndex];
                const sender = messageIndex % 2 === 0 ? user1 : user2;
                
                sender.messages.push({
                    text: message,
                    time: new Date(),
                    type: messageIndex % 2 === 0 ? 'sent' : 'received'
                });
                
                addLog('info', `💬 ${sender.name}: ${message}`);
                messageIndex++;
                
                updateUserDisplay();
            }, 2000);
        }
        
        function updateUserDisplay() {
            const container = document.getElementById('user-simulator');
            container.innerHTML = '';
            
            users.forEach(user => {
                const userCard = document.createElement('div');
                userCard.className = `user-card ${user.status}`;
                
                const statusText = {
                    'idle': '空闲',
                    'waiting': '等待匹配',
                    'matched': '已匹配',
                    'cancelled': '已取消'
                };
                
                const statusClass = {
                    'idle': '',
                    'waiting': 'status-pending',
                    'matched': 'status-matched',
                    'cancelled': 'status-cancelled'
                };
                
                userCard.innerHTML = `
                    <div class="user-header">
                        <div class="user-avatar">${user.avatar}</div>
                        <div class="user-info">
                            <h3>${user.name}</h3>
                            <p>用户ID: ${user.id}</p>
                        </div>
                    </div>
                    <div class="user-status ${statusClass[user.status]}">
                        ${statusText[user.status]}
                        ${user.matchedWith ? ` - 与 ${user.matchedWith} 聊天中` : ''}
                    </div>
                    <div class="user-actions">
                        ${user.status === 'idle' ? 
                            `<button class="btn" onclick="startHeartLink(${user.id})">开始心动链接</button>` :
                            user.status === 'waiting' ?
                            `<button class="btn danger" onclick="cancelHeartLink(${user.id})">取消</button>` :
                            user.status === 'matched' ?
                            `<button class="btn" onclick="viewChat(${user.id})">查看聊天</button>` :
                            `<button class="btn" onclick="resetUser(${user.id})">重置</button>`
                        }
                    </div>
                    ${user.messages.length > 0 ? `
                        <div class="chat-preview">
                            <h4>💬 聊天记录</h4>
                            <div class="chat-messages">
                                ${user.messages.slice(-3).map(msg => `
                                    <div class="message ${msg.type}">
                                        ${msg.text}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                `;
                
                container.appendChild(userCard);
            });
        }
        
        function updateStats() {
            document.getElementById('total-users').textContent = users.length;
            document.getElementById('waiting-users').textContent = users.filter(u => u.status === 'waiting').length;
            document.getElementById('matched-pairs').textContent = matchedPairs.length;
            document.getElementById('active-chats').textContent = activeChats.length;
        }
        
        function addLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = {
                type: type,
                message: message,
                timestamp: timestamp
            };
            
            logEntries.push(logEntry);
            
            const container = document.getElementById('log-container');
            const entryDiv = document.createElement('div');
            entryDiv.className = `log-entry log-${type}`;
            entryDiv.textContent = `[${timestamp}] ${message}`;
            
            container.appendChild(entryDiv);
            container.scrollTop = container.scrollHeight;
            
            // 限制日志条目数量
            if (logEntries.length > 50) {
                logEntries.shift();
                if (container.firstChild) {
                    container.removeChild(container.firstChild);
                }
            }
        }
        
        function clearLog() {
            logEntries = [];
            document.getElementById('log-container').innerHTML = '';
            addLog('info', '日志已清空');
        }
        
        function showMatchingAnimation() {
            document.getElementById('matching-animation').style.display = 'block';
        }
        
        function hideMatchingAnimation() {
            document.getElementById('matching-animation').style.display = 'none';
        }
        
        // 单个用户操作函数
        function startHeartLink(userId) {
            const user = users.find(u => u.id === userId);
            if (user && user.status === 'idle') {
                user.status = 'waiting';
                user.requestId = Date.now() + Math.random();
                addLog('info', `${user.name} 开始心动链接`);
                updateUserDisplay();
                updateStats();
            }
        }
        
        function cancelHeartLink(userId) {
            const user = users.find(u => u.id === userId);
            if (user && user.status === 'waiting') {
                user.status = 'cancelled';
                addLog('warning', `${user.name} 取消了心动链接请求`);
                updateUserDisplay();
                updateStats();
            }
        }
        
        function resetUser(userId) {
            const user = users.find(u => u.id === userId);
            if (user) {
                user.status = 'idle';
                user.requestId = null;
                user.matchedWith = null;
                user.chatRoom = null;
                user.messages = [];
                addLog('info', `${user.name} 已重置`);
                updateUserDisplay();
                updateStats();
            }
        }
        
        function viewChat(userId) {
            const user = users.find(u => u.id === userId);
            if (user && user.messages.length > 0) {
                addLog('info', `查看 ${user.name} 的聊天记录 (${user.messages.length} 条消息)`);
            }
        }
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            addLog('info', '多人心动链接测试系统已启动');
        });
    </script>
</body>
</html> 