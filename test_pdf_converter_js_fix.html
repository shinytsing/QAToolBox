<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF转换器JavaScript修复测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #ffffff;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid #333;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .upload-area {
            border: 2px dashed #666;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            border-radius: 10px;
            cursor: pointer;
        }
        .upload-area:hover {
            border-color: #007bff;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .status.success {
            background: #28a745;
            color: white;
        }
        .status.error {
            background: #dc3545;
            color: white;
        }
        .status.warning {
            background: #ffc107;
            color: black;
        }
    </style>
</head>
<body>
    <h1>PDF转换器JavaScript修复测试</h1>
    
    <div class="test-section">
        <h2>测试1: updateUploadHint函数</h2>
        <p>测试修复后的updateUploadHint函数是否能安全处理不存在的元素</p>
        <button class="test-button" onclick="testUpdateUploadHint()">测试updateUploadHint</button>
        <div id="test1-result"></div>
    </div>
    
    <div class="test-section">
        <h2>测试2: safeClick函数</h2>
        <p>测试修复后的safeClick函数是否能处理不存在的元素</p>
        <button class="test-button" onclick="testSafeClick()">测试safeClick</button>
        <div id="test2-result"></div>
    </div>
    
    <div class="test-section">
        <h2>测试3: 文件上传区域</h2>
        <p>测试文件上传区域的功能</p>
        <div class="upload-area" onclick="safeClick('fileInput')" id="uploadArea">
            <div>📁 点击选择文件</div>
            <div id="uploadHint">支持多种格式文件</div>
            <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" style="display: none;">
        </div>
        <button class="test-button" onclick="removeFileInput()">移除fileInput元素</button>
        <button class="test-button" onclick="recreateFileInput()">重新创建fileInput元素</button>
        <div id="test3-result"></div>
    </div>
    
    <div class="test-section">
        <h2>测试4: 转换类型选择</h2>
        <p>测试不同转换类型的提示更新</p>
        <button class="test-button" onclick="testSelectType('pdf-to-word')">PDF转Word</button>
        <button class="test-button" onclick="testSelectType('word-to-pdf')">Word转PDF</button>
        <button class="test-button" onclick="testSelectType('text-to-pdf')">文本转PDF</button>
        <div id="test4-result"></div>
    </div>

    <script>
        // 修复后的updateUploadHint函数
        function updateUploadHint(type) {
            const uploadHint = document.getElementById('uploadHint');
            const fileInput = document.getElementById('fileInput');
            
            // 安全地更新uploadHint
            if (uploadHint) {
                switch(type) {
                    case 'pdf-to-word':
                        uploadHint.textContent = '支持PDF文件，最大100MB';
                        break;
                    case 'word-to-pdf':
                        uploadHint.textContent = '支持Word文档 (.doc, .docx)，最大100MB';
                        break;
                    case 'pdf-to-image':
                        uploadHint.textContent = '支持PDF文件，最大100MB';
                        break;
                    case 'image-to-pdf':
                        uploadHint.textContent = '支持图片文件 (.jpg, .jpeg, .png, .gif, .bmp, .tiff)，最大100MB';
                        break;
                    case 'pdf-to-text':
                        uploadHint.textContent = '支持PDF文件，最大100MB';
                        break;
                    case 'text-to-pdf':
                        uploadHint.textContent = '请输入要转换的文本内容';
                        showTextInput();
                        return; // 文本转PDF不需要设置fileInput
                    default:
                        uploadHint.textContent = '支持多种格式文件，最大100MB';
                }
            }
            
            // 安全地更新fileInput
            if (fileInput) {
                switch(type) {
                    case 'pdf-to-word':
                        fileInput.accept = '.pdf';
                        break;
                    case 'word-to-pdf':
                        fileInput.accept = '.doc,.docx';
                        break;
                    case 'pdf-to-image':
                        fileInput.accept = '.pdf';
                        break;
                    case 'image-to-pdf':
                        fileInput.accept = '.jpg,.jpeg,.png,.gif,.bmp,.tiff';
                        break;
                    case 'pdf-to-text':
                        fileInput.accept = '.pdf';
                        break;
                    default:
                        fileInput.accept = '.pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.tiff';
                }
            } else {
                console.warn('fileInput element not found, skipping accept attribute update');
            }
        }

        // 修复后的safeClick函数
        function safeClick(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.click();
            } else {
                console.warn(`Element with id '${elementId}' not found`);
                // 不显示错误通知，避免用户体验问题
                // 尝试重新创建元素（如果是fileInput）
                if (elementId === 'fileInput') {
                    const uploadArea = document.getElementById('uploadArea');
                    if (uploadArea) {
                        // 重新创建fileInput元素
                        const fileInput = document.createElement('input');
                        fileInput.type = 'file';
                        fileInput.id = 'fileInput';
                        fileInput.accept = '.pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.tiff';
                        fileInput.style.display = 'none';
                        fileInput.addEventListener('change', handleFileUpload);
                        uploadArea.appendChild(fileInput);
                        
                        // 现在点击新创建的元素
                        fileInput.click();
                    }
                }
            }
        }

        // 显示文本输入区域
        function showTextInput() {
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.innerHTML = `
                <div>✏️ 文本转PDF</div>
                <textarea id="textInput" placeholder="请输入要转换为PDF的文本内容..." 
                          style="width: 100%; min-height: 200px; margin: 1rem 0; padding: 1rem; 
                                 border: 1px solid #666; border-radius: 8px; 
                                 background: #333; color: white; resize: vertical;"></textarea>
                <div>支持多行文本，自动分页</div>
            `;
            
            // 移除uploadArea的onclick事件，避免冲突
            uploadArea.removeAttribute('onclick');
        }

        // 文件上传处理
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                showStatus(`已选择文件: ${file.name}`, 'success');
            }
        }

        // 显示状态
        function showStatus(message, type) {
            const result = document.getElementById('test3-result');
            result.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // 测试函数
        function testUpdateUploadHint() {
            const result = document.getElementById('test1-result');
            try {
                // 测试正常情况
                updateUploadHint('pdf-to-word');
                
                // 测试fileInput不存在的情况
                const fileInput = document.getElementById('fileInput');
                if (fileInput) {
                    fileInput.remove();
                }
                updateUploadHint('word-to-pdf');
                
                result.innerHTML = '<div class="status success">✅ updateUploadHint函数测试通过，没有抛出错误</div>';
            } catch (error) {
                result.innerHTML = `<div class="status error">❌ updateUploadHint函数测试失败: ${error.message}</div>`;
            }
        }

        function testSafeClick() {
            const result = document.getElementById('test2-result');
            try {
                // 测试正常情况
                safeClick('fileInput');
                
                // 测试元素不存在的情况
                const fileInput = document.getElementById('fileInput');
                if (fileInput) {
                    fileInput.remove();
                }
                safeClick('fileInput');
                
                result.innerHTML = '<div class="status success">✅ safeClick函数测试通过，没有抛出错误</div>';
            } catch (error) {
                result.innerHTML = `<div class="status error">❌ safeClick函数测试失败: ${error.message}</div>`;
            }
        }

        function removeFileInput() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput) {
                fileInput.remove();
                showStatus('fileInput元素已移除', 'warning');
            } else {
                showStatus('fileInput元素不存在', 'warning');
            }
        }

        function recreateFileInput() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.id = 'fileInput';
            fileInput.accept = '.pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.tiff';
            fileInput.style.display = 'none';
            fileInput.addEventListener('change', handleFileUpload);
            uploadArea.appendChild(fileInput);
            showStatus('fileInput元素已重新创建', 'success');
        }

        function testSelectType(type) {
            const result = document.getElementById('test4-result');
            try {
                updateUploadHint(type);
                const uploadHint = document.getElementById('uploadHint');
                result.innerHTML = `<div class="status success">✅ 转换类型 "${type}" 测试通过，提示: "${uploadHint.textContent}"</div>`;
            } catch (error) {
                result.innerHTML = `<div class="status error">❌ 转换类型 "${type}" 测试失败: ${error.message}</div>`;
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput) {
                fileInput.addEventListener('change', handleFileUpload);
            }
        });
    </script>
</body>
</html> 