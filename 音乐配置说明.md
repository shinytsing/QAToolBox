# 音乐配置说明

## 概述

QAToolBox的音乐功能已经清除了本地音乐配置，现在支持在线音乐API。你需要配置相应的API密钥来启用完整的音乐功能。

## 支持的在线音乐API

### 1. Jamendo API
- **网站**: https://www.jamendo.com/
- **注册**: 免费注册获取API密钥
- **配置**: 在 `apps/tools/utils/music_api.py` 中设置 `client_id`

### 2. Free Music Archive API
- **网站**: https://freemusicarchive.org/
- **注册**: 免费注册获取API密钥
- **配置**: 在 `apps/tools/utils/music_api.py` 中设置 `api_key`

### 3. ccMixter API
- **网站**: http://ccmixter.org/
- **特点**: 免费音乐社区，无需API密钥
- **状态**: 已配置，可直接使用

### 4. Incompetech API
- **网站**: https://incompetech.com/
- **特点**: Kevin MacLeod的免费音乐，无需API密钥
- **状态**: 已配置，可直接使用

## 配置步骤

### 1. 获取API密钥

#### Jamendo API
1. 访问 https://www.jamendo.com/
2. 注册免费账户
3. 进入开发者页面
4. 创建应用获取 `client_id`

#### Free Music Archive API
1. 访问 https://freemusicarchive.org/
2. 注册免费账户
3. 申请API访问权限
4. 获取 `api_key`

### 2. 更新配置文件

编辑 `apps/tools/utils/music_api.py` 文件：

```python
# 在 _try_jamendo_api 方法中
params = {
    'client_id': 'your_actual_client_id_here',  # 替换为你的实际client_id
    'format': 'json',
    'limit': 10,
    'tags': tag_str,
    'include': 'musicinfo'
}

# 在 _try_freemusicarchive_api 方法中
params = {
    'api_key': 'your_actual_api_key_here',  # 替换为你的实际api_key
    'limit': 10,
    'sort': 'track_interest'
}
```

### 3. 环境变量配置（推荐）

为了安全起见，建议使用环境变量：

1. 在项目根目录创建 `.env` 文件：
```bash
JAMENDO_CLIENT_ID=your_actual_client_id_here
FMA_API_KEY=your_actual_api_key_here
```

2. 修改 `apps/tools/utils/music_api.py`：
```python
import os

# 在 __init__ 方法中
self.jamendo_client_id = os.environ.get('JAMENDO_CLIENT_ID', 'your_client_id')
self.fma_api_key = os.environ.get('FMA_API_KEY', 'your_api_key')

# 在相应的方法中使用
params = {
    'client_id': self.jamendo_client_id,
    # ... 其他参数
}
```

## 音乐模式说明

### 工作模式 (work)
- **标签**: instrumental, ambient, electronic, focus
- **用途**: 专注工作，提高效率
- **特点**: 轻音乐、环境音乐

### 生活模式 (life)
- **标签**: chill, acoustic, indie, folk
- **用途**: 轻松生活，享受时光
- **特点**: 轻松愉快的音乐

### 训练模式 (training)
- **标签**: rock, electronic, dance, energy
- **用途**: 激情训练，释放能量
- **特点**: 充满活力的音乐

### 情感模式 (emo)
- **标签**: indie, alternative, sad, melancholy
- **用途**: 情感共鸣，心灵治愈
- **特点**: 情感丰富的音乐

## 备用音乐

如果在线API不可用，系统会使用备用音乐数据。这些是示例URL，你可能需要替换为实际可用的音乐文件。

## 测试音乐功能

配置完成后，可以通过以下方式测试：

1. 访问音乐治愈页面
2. 选择不同的音乐模式
3. 测试音乐播放功能
4. 检查音乐搜索功能

## 故障排除

### 常见问题

1. **API请求失败**
   - 检查API密钥是否正确
   - 确认网络连接正常
   - 查看API服务状态

2. **音乐无法播放**
   - 检查音乐URL是否有效
   - 确认音乐文件格式支持
   - 查看浏览器控制台错误

3. **搜索功能不工作**
   - 确认API支持搜索功能
   - 检查搜索参数格式
   - 查看API文档

### 调试方法

1. 查看Django日志
2. 检查浏览器网络请求
3. 使用API测试工具验证密钥

## 注意事项

1. **API限制**: 免费API通常有请求次数限制
2. **音乐版权**: 确保使用的音乐符合版权要求
3. **性能优化**: 建议启用缓存减少API请求
4. **错误处理**: 系统会自动降级到备用音乐

## 更新日志

- **v1.0**: 清除本地音乐配置
- **v1.1**: 添加在线音乐API支持
- **v1.2**: 优化音乐缓存机制
- **v1.3**: 添加音乐搜索功能

## 联系支持

如果遇到配置问题，请：
1. 查看本文档的故障排除部分
2. 检查API服务商的状态页面
3. 联系技术支持团队 